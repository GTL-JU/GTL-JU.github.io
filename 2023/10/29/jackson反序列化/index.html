<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    <meta name="description" content="Hexo Theme Redefine">
    <meta name="author" content="GTL-JU">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-redefine.png">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://evan.beee.top" crossorigin>
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2023/10/29/jackson反序列化/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="一、前言在之前的buu月赛中，遇到了一道使用jackson依赖打内存马的题，由于并没有学习过jackson反序列化漏洞，这里对这个漏洞进行学习，以便于后面的题目复现。 二、关于jackson1、jackson的介绍Java生态圈中有很多处理JSON和XML格式化的类库， 常见的解析器：Jsonlib，Gson，fastjson，Jackson。Jackson是其中比较著名的一个，可以将Java对象">
<meta property="og:type" content="article">
<meta property="og:title" content="jackson反序列化原理学习">
<meta property="og:url" content="http://example.com/2023/10/29/jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="一、前言在之前的buu月赛中，遇到了一道使用jackson依赖打内存马的题，由于并没有学习过jackson反序列化漏洞，这里对这个漏洞进行学习，以便于后面的题目复现。 二、关于jackson1、jackson的介绍Java生态圈中有很多处理JSON和XML格式化的类库， 常见的解析器：Jsonlib，Gson，fastjson，Jackson。Jackson是其中比较著名的一个，可以将Java对象">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231026153730007.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/2DAC601E-70D8-4B3C-86CC-7E4972FC2466.jpg">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231026202037268.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231026202104524.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028170023175.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028171147939.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028171424097.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028172015428.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028175109573.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028180747834.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028181918781.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028185954048.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028190131938.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028191511962.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028191805282.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028191910654.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028192743317.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028193012521.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028193106651.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028193708798.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028194113889.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028194312205.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028194416544.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028205254249.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028205552322.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028205819239.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028210008938.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028210326672.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028210635389.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029143031810.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029143803433.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029143946516.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144113333.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144253448.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144347375.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144529401.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144709046.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144725701.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144904617.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029145008454.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144945486.png">
<meta property="article:published_time" content="2023-10-29T10:43:20.000Z">
<meta property="article:modified_time" content="2023-10-29T10:44:39.122Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231026153730007.png">
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/logo.png">
    <!--- Page Info-->
    
    <title>
        
            jackson反序列化原理学习 -
        
        JU blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/assets/fonts.css">

    <!--- Font Part-->
    
    
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":true,"list":["php","java","比赛wp","环境搭建"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":true,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true},"home_banner":{"enable":true,"image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"JU's blog","subtitle":{"text":[],"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"audios":[{"name":null,"artist":null,"url":null,"cover":null},{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.1.0","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Status":{"path":"https://status.evanluo.top/","icon":"fa-regular fa-chart-bar"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/GTL-JU","Blog":"https://www.cnblogs.com/GTL-JU/","Friends":"/friends"}},"友链":{"icon":"fa-regular fa-link","path":"/links/"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","announcement":null,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}}};
    Global.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                JU blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        首页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        归档
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    target="_blank" rel="noopener" href="https://status.evanluo.top/"  >
                                    
                                        
                                            <i class="fa-regular fa-chart-bar"></i>
                                        
                                        状态
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/GTL-JU">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GTL-JU/">BLOG
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="/friends">友情链接
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/links/"  >
                                    
                                        
                                            <i class="fa-regular fa-link"></i>
                                        
                                        友链
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                首页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                归档
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        target="_blank" rel="noopener" href="https://status.evanluo.top/"  >
                             
                                
                                    <i class="fa-regular fa-chart-bar"></i>
                                
                                状态
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/about">ME</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://github.com/GTL-JU">GITHUB</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://www.cnblogs.com/GTL-JU/">BLOG</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/friends">友情链接</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/links/"  >
                             
                                
                                    <i class="fa-regular fa-link"></i>
                                
                                友链
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
            
                <div class="article-title">
                    <h1 class="article-title-regular">jackson反序列化原理学习</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/logo.png">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">GTL-JU</span>
                            
                                <span class="author-label">Lv3</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-10-29 18:43:20</span>
        <span class="mobile">2023-10-29 18:43</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-10-29 18:44:39</span>
            <span class="mobile">2023-10-29 18:44</span>
            <span class="hover-info">更新</span>
        </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/java/">java</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>7.4k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>32 分钟</span>
        </span>
    
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p>在之前的buu月赛中，遇到了一道使用jackson依赖打内存马的题，由于并没有学习过jackson反序列化漏洞，这里对这个漏洞进行学习，以便于后面的题目复现。</p>
<h1 id="二、关于jackson"><a href="#二、关于jackson" class="headerlink" title="二、关于jackson"></a>二、关于jackson</h1><h2 id="1、jackson的介绍"><a href="#1、jackson的介绍" class="headerlink" title="1、jackson的介绍"></a>1、jackson的介绍</h2><p>Java生态圈中有很多处理JSON和XML格式化的类库， 常见的解析器：Jsonlib，Gson，fastjson，Jackson。Jackson是其中比较著名的一个，可以将Java对象序列化为XML或JSON格式的字符串，以及将XML或JSON格式的字符串反序列化为Java对象。并且jacksun的使用比较简单，速度快，且不依赖除JDK外的其他库。</p>
<p>使用的依赖</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.7.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.7.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.7.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="2、使用jackson进行序列化和反序列化"><a href="#2、使用jackson进行序列化和反序列化" class="headerlink" title="2、使用jackson进行序列化和反序列化"></a>2、使用jackson进行序列化和反序列化</h2><p>在jackson中提供了<code>ObjectMapper.writeValueAsString()</code>和<code>ObjectMapper.readValue()</code>两个方法来进行序列化和反序列化，通过<code>ObjectMapper.writeValueAsString()</code>方法将java对象序列化为json格式数据，通过<code>ObjectMapper.readValue()</code>方法将json格式数据反序列化成java对象。</p>
<p>下面我们通过一个demo来演示：</p>
<p>定义一个Product类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public class Product &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private double price;</span><br><span class="line">    private String description;</span><br><span class="line"></span><br><span class="line">    public Product(String name, double price, String description) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.price = price;</span><br><span class="line">        this.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public  Product()&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // Getters and Setters for the class properties</span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getPrice() &#123;</span><br><span class="line">        return price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPrice(double price) &#123;</span><br><span class="line">        this.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDescription() &#123;</span><br><span class="line">        return description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDescription(String description) &#123;</span><br><span class="line">        this.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Product&#123;&quot; +</span><br><span class="line">                &quot;name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, price=&quot; + price +</span><br><span class="line">                &quot;, description=&#x27;&quot; + description + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class test &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        Product product=new Product(&quot;苹果&quot;,10,&quot;优质&quot;);</span><br><span class="line">        ObjectMapper objectMapper =new ObjectMapper();</span><br><span class="line">        String w = objectMapper.writeValueAsString(product);</span><br><span class="line">        System.out.println(&quot;这里是序列化:&quot;);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">        Product r=objectMapper.readValue(w, Product.class);</span><br><span class="line">        System.out.println(&quot;这里是反序列化&quot;);</span><br><span class="line">        System.out.println(r);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231026153730007.png"
                      alt="image-20231026153730007"
                ></p>
<h2 id="3、jackson中的多态问题"><a href="#3、jackson中的多态问题" class="headerlink" title="3、jackson中的多态问题"></a>3、jackson中的多态问题</h2><p>我们这里先了解一些java中的多态：</p>
<p>多态是同一个行为具有多个不同表现形式或形态的能力。</p>
<p>我们可以理解为同一个接口，使用不同的实例而执行不同操作。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/2DAC601E-70D8-4B3C-86CC-7E4972FC2466.jpg"
                      alt="img"
                ></p>
<p>这里以菜鸟教程的一个demo来更好的说明：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">      show(new Cat());  // 以 Cat 对象调用 show 方法</span><br><span class="line">      show(new Dog());  // 以 Dog 对象调用 show 方法</span><br><span class="line">                </span><br><span class="line">      Animal a = new Cat();  // 向上转型  </span><br><span class="line">      a.eat();               // 调用的是 Cat 的 eat</span><br><span class="line">      Cat c = (Cat)a;        // 向下转型  </span><br><span class="line">      c.work();        // 调用的是 Cat 的 work</span><br><span class="line">  &#125;  </span><br><span class="line">            </span><br><span class="line">    public static void show(Animal a)  &#123;</span><br><span class="line">      a.eat();  </span><br><span class="line">        // 类型判断</span><br><span class="line">        if (a instanceof Cat)  &#123;  // 猫做的事情 </span><br><span class="line">            Cat c = (Cat)a;  </span><br><span class="line">            c.work();  </span><br><span class="line">        &#125; else if (a instanceof Dog) &#123; // 狗做的事情 </span><br><span class="line">            Dog c = (Dog)a;  </span><br><span class="line">            c.work();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">abstract class Animal &#123;  </span><br><span class="line">    abstract void eat();  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">class Cat extends Animal &#123;  </span><br><span class="line">    public void eat() &#123;  </span><br><span class="line">        System.out.println(&quot;吃鱼&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line">    public void work() &#123;  </span><br><span class="line">        System.out.println(&quot;抓老鼠&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">class Dog extends Animal &#123;  </span><br><span class="line">    public void eat() &#123;  </span><br><span class="line">        System.out.println(&quot;吃骨头&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line">    public void work() &#123;  </span><br><span class="line">        System.out.println(&quot;看家&quot;);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>可以看到我们在主函数中都调用了show方法，但是输出的结果却不一样</p>
<p>这也就是我们说的同一个接口，使用不同的实例而执行不同操作。</p>
<h2 id="4、JacksonPolymorphicDeserialization机制解决jackson的多态问题"><a href="#4、JacksonPolymorphicDeserialization机制解决jackson的多态问题" class="headerlink" title="4、JacksonPolymorphicDeserialization机制解决jackson的多态问题"></a>4、<code>JacksonPolymorphicDeserialization</code>机制解决<code>jackson</code>的多态问题</h2><p>我们上面说了多态就是使用同一个接口，使用不同的实例实现不同的操作</p>
<p>那么现在就出现了一个问题，我们如果在对多态类的某一个子类实例在进行序列化后反序列化，那么反序列化出来的实例是我们想要的那个子类的实例吗，会不会反序列化出其他子类的实例。</p>
<p>然后jackson就是通过<code>JacksonPolymorphicDeserialization</code>机制这个机制来解决这个问题的。</p>
<p><code>JacksonPolymorphicDeserialization</code>在反序列化某个类对象的过程中，如果这个类的对象不是具体的类型，例如object，接口或者抽象类，那么我们就可以在json字符串中指定其具体类型。这样jackson就可以生成具体类型的实例。</p>
<p><code>JacksonPolymorphicDeserialization</code>机制就是将具体的子类信息绑定在序列化的内容中，从而在后续进行反序列化的时候直接得到目标子类对象。</p>
<p><code>JacksonPolymorphicDeserialization</code>机制有两种方法来解决这个问题：<code>DefaultTyping</code>和<code>@JsonTypeInfo</code>注解。</p>
<h3 id="DefaultTyping"><a href="#DefaultTyping" class="headerlink" title="DefaultTyping"></a>DefaultTyping</h3><p>jackson提供一个<code>enableDefaultTyping</code>设置</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231026202037268.png"
                      alt="image-20231026202037268"
                ></p>
<p>包含四个值</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231026202104524.png"
                      alt="image-20231026202104524"
                ></p>
<p>在默认情况下，也就是<code>enableDefaultTyping</code>在无参数的情况下，默认选择<code>OBJECT_AND_NON_CONCRETE</code></p>
<p>我们下面结合我们上面的demo详细分析一下：</p>
<h4 id="JAVA-LANG-OBJECT"><a href="#JAVA-LANG-OBJECT" class="headerlink" title="JAVA_LANG_OBJECT"></a>JAVA_LANG_OBJECT</h4><p>我们这里添加一个类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public class hacker &#123;</span><br><span class="line">    public String skill = &quot;hacker&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>修改 Product类添加一个Object属性</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">public class Product &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private double price;</span><br><span class="line">    private String description;</span><br><span class="line">    public Object object;</span><br><span class="line"></span><br><span class="line">    public Product(String name, double price, String description,Object object) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.price = price;</span><br><span class="line">        this.description = description;</span><br><span class="line">        this.object=object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public  Product()&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // Getters and Setters for the class properties</span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getPrice() &#123;</span><br><span class="line">        return price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPrice(double price) &#123;</span><br><span class="line">        this.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDescription() &#123;</span><br><span class="line">        return description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDescription(String description) &#123;</span><br><span class="line">        this.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Product&#123;&quot; +</span><br><span class="line">                &quot;name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, price=&quot; + price +</span><br><span class="line">                &quot;, description=&#x27;&quot; + description + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, object=&quot; + object +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>修改测试类，添加<code>enableDefaultTyping()</code>并设置为JAVA_LANG_OBJECT：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class test &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        Product product=new Product(&quot;苹果&quot;,10,&quot;优质&quot;,new hacker());</span><br><span class="line">        ObjectMapper objectMapper =new ObjectMapper();</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT);</span><br><span class="line">        String w = objectMapper.writeValueAsString(product);</span><br><span class="line">        System.out.println(&quot;这里是序列化:&quot;);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">        Product r=objectMapper.readValue(w, Product.class);</span><br><span class="line">        System.out.println(&quot;这里是反序列化&quot;);</span><br><span class="line">        System.out.println(r);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>运行测试：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这里是序列化:</span><br><span class="line">&#123;&quot;name&quot;:&quot;苹果&quot;,&quot;price&quot;:10.0,&quot;description&quot;:&quot;优质&quot;,&quot;object&quot;:[&quot;blog.hacker&quot;,&#123;&quot;skill&quot;:&quot;hacker&quot;&#125;]&#125;</span><br><span class="line">这里是反序列化</span><br><span class="line">Product&#123;name=&#x27;苹果&#x27;, price=10.0, description=&#x27;优质&#x27;, object=blog.hacker@5dfcfece&#125;</span><br></pre></td></tr></table></figure></div>

<p>注释掉<code>enableDefaultTyping()</code>：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这里是序列化:</span><br><span class="line">&#123;&quot;name&quot;:&quot;苹果&quot;,&quot;price&quot;:10.0,&quot;description&quot;:&quot;优质&quot;,&quot;object&quot;:&#123;&quot;skill&quot;:&quot;hacker&quot;&#125;&#125;</span><br><span class="line">这里是反序列化</span><br><span class="line">Product&#123;name=&#x27;苹果&#x27;, price=10.0, description=&#x27;优质&#x27;, object=&#123;skill=hacker&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p>通过上面是否添加<code>enableDefaultTyping()</code>并设置<code>JAVA_LANG_OBJECT</code>对比可以看到，添加后会在序列化的时候多输出hacke的类名，并且在反序列化的时候，添加了<code>enableDefaultTyping()</code>的只会输出hacker类对象。那么这里就是说对Object同时进行了序列化和反序列化操作。</p>
<h4 id="OBJECT-AND-NON-CONCRETE"><a href="#OBJECT-AND-NON-CONCRETE" class="headerlink" title="OBJECT_AND_NON_CONCRETE"></a>OBJECT_AND_NON_CONCRETE</h4><p><code>OBJECT_AND_NON_CONCRETE</code>除了<code>JAVA_LANG_OBJECT</code>的可以对Object对象进行序列化和反序列化，当类里面有接口，抽象类的时候，对其进行序列化和反序列化。而且<code>enableDefaultTyping()</code>默认无参数的情况下的设置就是这个选项。</p>
<p>我们这里通过实现一个接口来进行测试：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface productjie &#123;</span><br><span class="line">    public void setprice(int price);</span><br><span class="line">    public int getprice();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>写一个类继承这个接口</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class myproductjie implements productjie &#123;</span><br><span class="line">    int price;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setprice(int price) &#123;</span><br><span class="line">        this.price=price;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getprice() &#123;</span><br><span class="line">        return price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>修改一下product类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">public class Product &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private double price;</span><br><span class="line">    private String description;</span><br><span class="line">    public Object object;</span><br><span class="line">    public productjie productjie;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public Product(String name, double price, String description,Object object,productjie productjie) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.price = price;</span><br><span class="line">        this.description = description;</span><br><span class="line">        this.object=object;</span><br><span class="line">        this.productjie=productjie;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public  Product()&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // Getters and Setters for the class properties</span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getPrice() &#123;</span><br><span class="line">        return price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPrice(double price) &#123;</span><br><span class="line">        this.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDescription() &#123;</span><br><span class="line">        return description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDescription(String description) &#123;</span><br><span class="line">        this.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Product&#123;&quot; +</span><br><span class="line">                &quot;name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, price=&quot; + price +</span><br><span class="line">                &quot;, description=&#x27;&quot; + description + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, object=&quot; + object +</span><br><span class="line">                &quot;, productjie=&quot; + productjie +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>修改测试类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class test &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        Product product=new Product(&quot;苹果&quot;,10,&quot;优质&quot;,new hacker(),new myproductjie());</span><br><span class="line">        ObjectMapper objectMapper =new ObjectMapper();</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE);</span><br><span class="line">        String w = objectMapper.writeValueAsString(product);</span><br><span class="line">        System.out.println(&quot;这里是序列化:&quot;);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">        Product r=objectMapper.readValue(w, Product.class);</span><br><span class="line">        System.out.println(&quot;这里是反序列化&quot;);</span><br><span class="line">        System.out.println(r);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这里是序列化:</span><br><span class="line">&#123;&quot;name&quot;:&quot;苹果&quot;,&quot;price&quot;:10.0,&quot;description&quot;:&quot;优质&quot;,&quot;object&quot;:[&quot;blog.hacker&quot;,&#123;&quot;skill&quot;:&quot;hacker&quot;&#125;],&quot;productjie&quot;:[&quot;blog.myproductjie&quot;,&#123;&quot;price&quot;:0&#125;]&#125;</span><br><span class="line">这里是反序列化</span><br><span class="line">Product&#123;name=&#x27;苹果&#x27;, price=10.0, description=&#x27;优质&#x27;, object=blog.hacker@6cc4c815, productjie=blog.myproductjie@3a82f6ef&#125;</span><br></pre></td></tr></table></figure></div>

<p>我们这里可以看到我们定义的接口属性被成功序列化和反序列化了</p>
<p>那我们如果还是用上面那个<code>JAVA_LANG_OBJECT</code>设置值来测试一下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028170023175.png"
                      alt="image-20231028170023175"
                ></p>
<p>我们可以看到我们替换为<code>JAVA_LANG_OBJECT</code>的时候在进行反序列化的时候产生了报错。</p>
<p>抛出了一个异常这个异常的根本原因是 Jackson 在反序列化时遇到了一个抽象类型或接口类型，而无法确定如何实例化它，因为抽象类型不能直接实例化。</p>
<h4 id="NON-CONCRETE-AND-ARRAYS"><a href="#NON-CONCRETE-AND-ARRAYS" class="headerlink" title="NON_CONCRETE_AND_ARRAYS"></a>NON_CONCRETE_AND_ARRAYS</h4><p><code>NON_CONCRETE_AND_ARRAYS</code>除了上面的Object，接口，抽象类型可以被序列化和反序列化，还支持Array类型</p>
<p>这里直接将测试代码中的hacker对象修改为数组类型的就行l</p>
<p>修个测试代码：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class test &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        hacker[] hacker = new hacker[2];</span><br><span class="line">        hacker[0]=new hacker();</span><br><span class="line">        hacker[1]=new hacker();</span><br><span class="line">        Product product=new Product(&quot;苹果&quot;,10,&quot;优质&quot;,hacker,new myproductjie());</span><br><span class="line">        ObjectMapper objectMapper =new ObjectMapper();</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_CONCRETE_AND_ARRAYS);</span><br><span class="line">        String w = objectMapper.writeValueAsString(product);</span><br><span class="line">        System.out.println(&quot;这里是序列化:&quot;);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">        Product r=objectMapper.readValue(w, Product.class);</span><br><span class="line">        System.out.println(&quot;这里是反序列化&quot;);</span><br><span class="line">        System.out.println(r);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">这里是序列化:</span><br><span class="line">&#123;&quot;name&quot;:&quot;苹果&quot;,&quot;price&quot;:10.0,&quot;description&quot;:&quot;优质&quot;,&quot;object&quot;:[&quot;[Lblog.hacker;&quot;,[&#123;&quot;skill&quot;:&quot;hacker&quot;&#125;,&#123;&quot;skill&quot;:&quot;hacker&quot;&#125;]],&quot;productjie&quot;:[&quot;blog.myproductjie&quot;,&#123;&quot;price&quot;:0&#125;]&#125;</span><br><span class="line">这里是反序列化</span><br><span class="line">Product&#123;name=&#x27;苹果&#x27;, price=10.0, description=&#x27;优质&#x27;, object=[Lblog.hacker;@20e2cbe0, productjie=blog.myproductjie@68be2bc2&#125;</span><br></pre></td></tr></table></figure></div>

<p>同样的我们将这个设置值换成前面的尝试运行：</p>
<p>这里更换为<code>JAVA_LANG_OBJECT</code>测试</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028171147939.png"
                      alt="image-20231028171147939"
                ></p>
<p>但是这里经过测试发现 <code>OBJECT_AND_NON_CONCRETE</code>也可也正常序列化和反序列化数组</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028171424097.png"
                      alt="image-20231028171424097"
                ></p>
<h4 id="NON-FINAL"><a href="#NON-FINAL" class="headerlink" title="NON_FINAL"></a>NON_FINAL</h4><p>NON_FINAL：除了前面的所有特征外，包含即将被序列化的类里的全部、非final的属性，也就是相当于整个类、除final外的属性信息都需要被序列化和反序列化。</p>
<p>这里就修改一些test代码的中的属性设置值就可以了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028172015428.png"
                      alt="image-20231028172015428"
                ></p>
<h3 id="JsonTypeInfo注解"><a href="#JsonTypeInfo注解" class="headerlink" title="@JsonTypeInfo注解"></a>@JsonTypeInfo注解</h3><p><code>@JsonTypeInfo</code> 注解是 Jackson 库中的一个重要注解，用于在序列化和反序列化 JSON 数据时指定类型信息。它允许你为类的字段或属性添加类型信息，以便 Jackson 可以正确地识别和处理多态类型的数据。</p>
<p><strong>使用 <code>JsonTypeInfo.Id</code> 枚举：</strong> 可以指定 <code>use</code> 属性为 <code>JsonTypeInfo.Id</code> 枚举值之一，以确定类型信息的使用方式。常见的枚举值包括：</p>
<p>​    <code>JsonTypeInfo.Id.NONE</code> </p>
<ul>
<li><p><code>JsonTypeInfo.Id.CLASS</code>：使用类名作为类型信息。</p>
</li>
<li><p><code>JsonTypeInfo.Id.MINIMAL_CLASS</code>：使用类名的简短版本。</p>
</li>
<li><p><code>JsonTypeInfo.Id.NAME</code>：使用自定义的类型名称。</p>
</li>
<li><p><code>JsonTypeInfo.Id.CUSTOM</code>自定义处理器处理</p>
</li>
</ul>
<h4 id="JsonTypeInfo-Id-NONE"><a href="#JsonTypeInfo-Id-NONE" class="headerlink" title="JsonTypeInfo.Id.NONE"></a>JsonTypeInfo.Id.NONE</h4><p>这里简化一下代码方便修改测试：</p>
<p>在object属性上面添加<code>@JsonTypeInfo</code>注解，并指定为<code>JsonTypeInfo.Id.NONE</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import com.fasterxml.jackson.annotation.JsonTypeInfo;</span><br><span class="line"></span><br><span class="line">public class product &#123;</span><br><span class="line">    public int price;</span><br><span class="line">    public String name;</span><br><span class="line">    @JsonTypeInfo(use = JsonTypeInfo.Id.NONE)</span><br><span class="line">    public Object object;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return String.format(&quot;Person.age=%d, Person.name=%s, %s&quot;, price, name, object == null ? &quot;null&quot; : object);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>test类</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class test &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Product product = new Product();</span><br><span class="line">        product.price=10;</span><br><span class="line">        product.name=&quot;苹果&quot;;</span><br><span class="line">        product.object=new hacker();</span><br><span class="line">        ObjectMapper mapper = new ObjectMapper();</span><br><span class="line"></span><br><span class="line">        String json = mapper.writeValueAsString(product);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">         Product p2 = mapper.readValue(json, Product.class);</span><br><span class="line">        System.out.println(p2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;price&quot;:10,&quot;name&quot;:&quot;苹果&quot;,&quot;object&quot;:&#123;&quot;skill&quot;:&quot;hacker&quot;&#125;&#125;</span><br><span class="line">Person.age=10, Person.name=苹果, &#123;skill=hacker&#125;</span><br></pre></td></tr></table></figure></div>

<p>我们这里把注解给注释掉：</p>
<p>再次运行</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028175109573.png"
                      alt="image-20231028175109573"
                ></p>
<p>可以看到两个结果是一样的，所以<code>JsonTypeInfo.Id.NONE</code>时没有任何处理的，和没有使用注解的效果是一样的。</p>
<h4 id="JsonTypeInfo-Id-CLASS"><a href="#JsonTypeInfo-Id-CLASS" class="headerlink" title="JsonTypeInfo.Id.CLASS"></a>JsonTypeInfo.Id.CLASS</h4><p>修改注解的值为<code>JsonTypeInfo.Id.CLASS</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;price&quot;:10,&quot;name&quot;:&quot;苹果&quot;,&quot;object&quot;:&#123;&quot;@class&quot;:&quot;blog.hacker&quot;,&quot;skill&quot;:&quot;hacker&quot;&#125;&#125;</span><br><span class="line">Person.age=10, Person.name=苹果, blog.hacker@4b9e13df</span><br></pre></td></tr></table></figure></div>

<p>可以看到与上面的输出相比多了<code>&quot;@class&quot;:&quot;blog.hacker&quot;</code>，包含了具体的类的信息。可以对指定的类进行序列化和反序列化，我们根据输出结果可以看到成功对object属性的hacker类进行了序列化和反序列化。</p>
<h4 id="JsonTypeInfo-Id-MINIMAL-CLASS"><a href="#JsonTypeInfo-Id-MINIMAL-CLASS" class="headerlink" title="JsonTypeInfo.Id.MINIMAL_CLASS"></a>JsonTypeInfo.Id.MINIMAL_CLASS</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;price&quot;:10,&quot;name&quot;:&quot;苹果&quot;,&quot;object&quot;:&#123;&quot;@c&quot;:&quot;blog.hacker&quot;,&quot;skill&quot;:&quot;hacker&quot;&#125;&#125;</span><br><span class="line">Person.age=10, Person.name=苹果, blog.hacker@475530b9</span><br></pre></td></tr></table></figure></div>

<p>与上面的输出做对比可以看到基本产不多但是@class换成了@c，官方描述缩短了相关类名，但是真实效果和<code>JsonTypeInfo.Id.CLASS</code></p>
<p>是一样的，能够成功对我们指定的类型进行序列化和反序列化。</p>
<h4 id="JsonTypeInfo-Id-NAME"><a href="#JsonTypeInfo-Id-NAME" class="headerlink" title="JsonTypeInfo.Id.NAME"></a>JsonTypeInfo.Id.NAME</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028180747834.png"
                      alt="image-20231028180747834"
                ></p>
<p>可以看到在序列化输出的json对象中多了一个@type，但是具体的包名，类名却没有，这导致在后面反序列化的时候抛出了异常，无法正常反序列化。那么根据这个结果我们可以知道这个值是不能在反序列化利用的。</p>
<h4 id="JsonTypeInfo-Id-CUSTOM"><a href="#JsonTypeInfo-Id-CUSTOM" class="headerlink" title="JsonTypeInfo.Id.CUSTOM"></a>JsonTypeInfo.Id.CUSTOM</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028181918781.png"
                      alt="image-20231028181918781"
                ></p>
<p>这个值在进行序列化的时候就抛出了异常。因为这个值是提供给用户自定义的，没有办法直接使用，需要手动写一个解析器才能配合使用这个值，直接调用就会抛出异常。</p>
<p>那这里其实根据我们前面的测试，，当@JsonTypeInfo注解设置为如下值之一并且修饰的是Object类型的属性时，我们可以使用<code>JsonTypeInfo.Id.CLASS</code>，<code>JsonTypeInfo.Id.MINIMAL_CLASS</code>可以利用来触发jackson反序列化漏洞。</p>
<h2 id="5、jackson反序列化中类属性方法的调用"><a href="#5、jackson反序列化中类属性方法的调用" class="headerlink" title="5、jackson反序列化中类属性方法的调用"></a>5、jackson反序列化中类属性方法的调用</h2><p>在上面我们学习了jackson是如何通过<code>JacksonPolymorphicDeserialization</code>机制下的多态的序列化和反序列化</p>
<p>然后我们这里来看一下jackson在<code>JacksonPolymorphicDeserialization</code>机制下类属性方法的调用。</p>
<h3 id="DefaultTyping场景下："><a href="#DefaultTyping场景下：" class="headerlink" title="DefaultTyping场景下："></a>DefaultTyping场景下：</h3><p>这里对Product代码稍微做一个修改，每个类方法属性都加上一个输出语句，便于我们判断是否调用</p>
<p>Product类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">package blog;</span><br><span class="line"></span><br><span class="line">public class Product &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private double price;</span><br><span class="line">    private String description;</span><br><span class="line">    public Object object;</span><br><span class="line">    public productjie productjie;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public Product(String name, double price, String description,Object object,productjie productjie) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.price = price;</span><br><span class="line">        this.description = description;</span><br><span class="line">        this.object=object;</span><br><span class="line">        this.productjie=productjie;</span><br><span class="line">        System.out.println(&quot;这里是有参构造&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public  Product()&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;这里是无参构造&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // Getters and Setters for the class properties</span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        System.out.println(&quot;这里是getname方法&quot;);</span><br><span class="line">        return name;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        System.out.println(&quot;这里调用了setname方法&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getPrice() &#123;</span><br><span class="line">        System.out.println(&quot;这里调用了getprice方法&quot;);</span><br><span class="line">        return price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPrice(double price) &#123;</span><br><span class="line">        System.out.println(&quot;这里调用了setprice方法&quot;);</span><br><span class="line">        this.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDescription() &#123;</span><br><span class="line">        System.out.println(&quot;这里调用了getdescripition方法&quot;);</span><br><span class="line">        return description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDescription(String description) &#123;</span><br><span class="line">        System.out.println(&quot;这里调用了setdescripition方法&quot;);</span><br><span class="line"></span><br><span class="line">        this.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Product&#123;&quot; +</span><br><span class="line">                &quot;name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, price=&quot; + price +</span><br><span class="line">                &quot;, description=&#x27;&quot; + description + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, object=&quot; + object +</span><br><span class="line">                &quot;, productjie=&quot; + productjie +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>测试类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class test &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        hacker[] hacker = new hacker[2];</span><br><span class="line">        hacker[0]=new hacker();</span><br><span class="line">        hacker[1]=new hacker();</span><br><span class="line">        Product product=new Product(&quot;苹果&quot;,10,&quot;优质&quot;,new hacker(),new myproductjie());</span><br><span class="line">        ObjectMapper objectMapper =new ObjectMapper();</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_CONCRETE_AND_ARRAYS);</span><br><span class="line">        String w = objectMapper.writeValueAsString(product);</span><br><span class="line">        System.out.println(&quot;这里是序列化:&quot;);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">        Product r=objectMapper.readValue(w, Product.class);</span><br><span class="line">        System.out.println(&quot;这里是反序列化&quot;);</span><br><span class="line">        System.out.println(r);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">这里是有参构造</span><br><span class="line">这里是getname方法</span><br><span class="line">这里调用了getprice方法</span><br><span class="line">这里调用了getdescripition方法</span><br><span class="line">这里是序列化:</span><br><span class="line">&#123;&quot;name&quot;:&quot;苹果&quot;,&quot;price&quot;:10.0,&quot;description&quot;:&quot;优质&quot;,&quot;object&quot;:[&quot;blog.hacker&quot;,&#123;&quot;skill&quot;:&quot;hacker&quot;&#125;],&quot;productjie&quot;:[&quot;blog.myproductjie&quot;,&#123;&quot;price&quot;:0&#125;]&#125;</span><br><span class="line">这里是无参构造</span><br><span class="line">这里调用了setname方法</span><br><span class="line">这里调用了setprice方法</span><br><span class="line">这里调用了setdescripition方法</span><br><span class="line">这里是反序列化</span><br><span class="line">Product&#123;name=&#x27;苹果&#x27;, price=10.0, description=&#x27;优质&#x27;, object=blog.hacker@6cc4c815, productjie=blog.myproductjie@3a82f6ef&#125;</span><br></pre></td></tr></table></figure></div>

<p>根据上面运行结果的输出，我们可以看到在序列化的时候调用了构造函数和get方法</p>
<p>但是在反序列化的时候调用了构造方法和set方法</p>
<p>我们继续分析在使用注解的情况下:</p>
<h3 id="JsonTypeInfo注解场景下："><a href="#JsonTypeInfo注解场景下：" class="headerlink" title="@JsonTypeInfo注解场景下："></a>@JsonTypeInfo注解场景下：</h3><p>修改Product代码在productjie属性上面添加注解属性</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">package blog;</span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.annotation.JsonTypeInfo;</span><br><span class="line"></span><br><span class="line">public class Product &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private double price;</span><br><span class="line">    private String description;</span><br><span class="line">    public Object object;</span><br><span class="line">    @JsonTypeInfo(use = JsonTypeInfo.Id.CLASS)</span><br><span class="line">    public productjie productjie;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public Product(String name, double price, String description,Object object,productjie productjie) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.price = price;</span><br><span class="line">        this.description = description;</span><br><span class="line">        this.object=object;</span><br><span class="line">        this.productjie=productjie;</span><br><span class="line">        System.out.println(&quot;这里是有参构造&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public  Product()&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;这里是无参构造&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // Getters and Setters for the class properties</span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        System.out.println(&quot;这里是getname方法&quot;);</span><br><span class="line">        return name;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        System.out.println(&quot;这里调用了setname方法&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public double getPrice() &#123;</span><br><span class="line">        System.out.println(&quot;这里调用了getprice方法&quot;);</span><br><span class="line">        return price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPrice(double price) &#123;</span><br><span class="line">        System.out.println(&quot;这里调用了setprice方法&quot;);</span><br><span class="line">        this.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDescription() &#123;</span><br><span class="line">        System.out.println(&quot;这里调用了getdescripition方法&quot;);</span><br><span class="line">        return description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDescription(String description) &#123;</span><br><span class="line">        System.out.println(&quot;这里调用了setdescripition方法&quot;);</span><br><span class="line"></span><br><span class="line">        this.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Product&#123;&quot; +</span><br><span class="line">                &quot;name=&#x27;&quot; + name + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, price=&quot; + price +</span><br><span class="line">                &quot;, description=&#x27;&quot; + description + &#x27;\&#x27;&#x27; +</span><br><span class="line">                &quot;, object=&quot; + object +</span><br><span class="line">                &quot;, productjie=&quot; + productjie +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>测试类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class test &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        Product product=new Product(&quot;苹果&quot;,10,&quot;优质&quot;,new hacker(),new myproductjie());</span><br><span class="line">        ObjectMapper objectMapper =new ObjectMapper();</span><br><span class="line">        String w = objectMapper.writeValueAsString(product);</span><br><span class="line">        System.out.println(&quot;这里是序列化:&quot;);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">        Product r=objectMapper.readValue(w, Product.class);</span><br><span class="line">        System.out.println(&quot;这里是反序列化&quot;);</span><br><span class="line">        System.out.println(r);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">这里是有参构造</span><br><span class="line">这里是getname方法</span><br><span class="line">这里调用了getprice方法</span><br><span class="line">这里调用了getdescripition方法</span><br><span class="line">这里是序列化:</span><br><span class="line">&#123;&quot;name&quot;:&quot;苹果&quot;,&quot;price&quot;:10.0,&quot;description&quot;:&quot;优质&quot;,&quot;object&quot;:&#123;&quot;skill&quot;:&quot;hacker&quot;&#125;,&quot;productjie&quot;:&#123;&quot;@class&quot;:&quot;blog.myproductjie&quot;,&quot;price&quot;:0&#125;&#125;</span><br><span class="line">这里是无参构造</span><br><span class="line">这里调用了setname方法</span><br><span class="line">这里调用了setprice方法</span><br><span class="line">这里调用了setdescripition方法</span><br><span class="line">这里是反序列化</span><br><span class="line">Product&#123;name=&#x27;苹果&#x27;, price=10.0, description=&#x27;优质&#x27;, object=&#123;skill=hacker&#125;, productjie=blog.myproductjie@6767c1fc&#125;</span><br></pre></td></tr></table></figure></div>

<p>我们看到这里调用的类属性方法是和上面在DefaultTyping场景下的结果是一样的。</p>
<h3 id="动态调试"><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h3><p>那么根据上面的测试，jackson在进行反序列化的过程中首先是通过构造函数生成实列，然后调用调用set方法设置实例的属性值，我们这里打断点动态调试一下这个过程</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028185954048.png"
                      alt="image-20231028185954048"
                ></p>
<p>前面一部分代码都是读取json数据对象</p>
<p>然后调用deserialize方法对json对象进行反序列化操作</p>
<p>我们这里跟进去分析一下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028190131938.png"
                      alt="image-20231028190131938"
                ></p>
<p>首先通过<code>p.isExpectedStartObjectToken()</code>检查是否是在处理一个json对象</p>
<p>然后调用<code>vanillaDeserialize</code>进行处理</p>
<p>跟进这个方法</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028191511962.png"
                      alt="image-20231028191511962"
                ></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">final Object bean = _valueInstantiator.createUsingDefault(ctxt);</span><br></pre></td></tr></table></figure></div>

<p>首先这里是先通过<code>createUsingDefault</code>这个方法来调用指定类的无参构造函数来生成类实例</p>
<p>那么到这里我们也就知道了无参构造函数在jackson反序列化的调用过程</p>
<p>跟进这个方法</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028191805282.png"
                      alt="image-20231028191805282"
                ></p>
<p>这里调用了call方法</p>
<p>跟进</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028191910654.png"
                      alt="image-20231028191910654"
                ></p>
<p>进入call方法我们可以看到调用了newInstace()方法对<code>_constructor</code>进行实例化，这里的<code>_constructor</code>我们根据调试信息可以看到就是我们定义的product类</p>
<p>那么根据上面的调试分析我们可以知道实例化的过程</p>
<p>然后跳出createUsingDefault方法进行向下分析代码</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028192743317.png"
                      alt="image-20231028192743317"
                ></p>
<p>我们这里简单分析一些代码</p>
<p><code>if (p.hasTokenId(JsonTokenId.ID_FIELD_NAME))</code>: 这个条件检查 JSON 标记（token）是否是字段名。在 JSON 中，字段名是一个字符串，例如 <code>&quot;name&quot;: &quot;John&quot;</code> 中的 <code>&quot;name&quot;</code> 就是字段名。</p>
<p><code>String propName = p.getCurrentName();</code>: 如果 JSON 标记是字段名，那么这一行代码会获取当前字段名，并将其存储在 <code>propName</code> 变量中。</p>
<p>然后可以看到是一个dowhile循环用于处理对象的各个属性。在每次迭代中，它会获取下一个字段名，并继续处理，直到没有更多字段名为止。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028193012521.png"
                      alt="image-20231028193012521"
                ></p>
<p>如果找到了与字段名匹配的属性，那么它会进入这个条件块。在这个块中，它尝试使用属性的 <code>deserializeAndSet</code> 方法来将 JSON 数据中的值设置到 Java 对象的属性上。</p>
<p>我们这里跟进到这个deserializeAndSet方法</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028193106651.png"
                      alt="image-20231028193106651"
                ></p>
<p>可以看到这里也调用了deserialize方法</p>
<p>跟进到这个deserialize方法：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028193708798.png"
                      alt="image-20231028193708798"
                ></p>
<p>可以看到这里有两个处理逻辑</p>
<p>第一个逻辑用于处理 JSON 中属性值为 null 的情况，将其映射为 Java 对象的属性值为 null。</p>
<p>第二个if判断</p>
<p>首先，它检查 <code>_valueTypeDeserializer</code> 是否为非空，即是否存在类型信息。如果存在类型信息，说明该属性值包含了类型信息。</p>
<p>如果存在类型信息，它会调用 <code>_valueDeserializer.deserializeWithType(p, ctxt, _valueTypeDeserializer)</code> 来执行反序列化操作。这个方法传递了当前的 JSON 解析器 <code>p</code>、反序列化上下文 <code>ctxt</code> 以及类型信息 <code>_valueTypeDeserializer</code>。</p>
<p>如果 <code>_valueTypeDeserializer</code> 为空，说明属性值不包含类型信息，它将简单地调用 <code>_valueDeserializer.deserialize(p, ctxt)</code> 来执行属性值的反序列化。这将根据属性值的实际类型执行反序列化。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028194113889.png"
                      alt="image-20231028194113889"
                ></p>
<p>我们的第一个属性是name，所以可以看到这里调用的是StringDeserializerl来获取name属性的值</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028194312205.png"
                      alt="image-20231028194312205"
                ></p>
<p>当获取到属性值后回到<code>deserializeAndSet</code>方法调用属性的setter方法来对实例的属性值进行设置。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028194416544.png"
                      alt="image-20231028194416544"
                ></p>
<p>后面就还是进行dowhile设置 后面price和description的值。</p>
<p>但是hacker是一个包含类名的数组</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028205254249.png"
                      alt="image-20231028205254249"
                ></p>
<p>可以看到这里的类型不为空，也就是<code>_valueTypeDeserializer</code>的值不为空</p>
<p>然后这里调用了<code>_valueDeserializer.deserializeWithType(p, ctxt, _valueTypeDeserializer);</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028205552322.png"
                      alt="image-20231028205552322"
                ></p>
<p>跟进去这个处理函数</p>
<p>一直跟进到调用_deserialize方法</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028205819239.png"
                      alt="image-20231028205819239"
                ></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tring typeId = _locateTypeId(p, ctxt);</span><br></pre></td></tr></table></figure></div>

<p>在这里可以看到调用<code>_locateTypeId()</code>函数获取到了类型为：blog.hacker</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028210008938.png"
                      alt="image-20231028210008938"
                ></p>
<p>然后这里根据取到的类型<code>_findDeserializer</code>方法来寻找对应的反序列化器</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028210326672.png"
                      alt="image-20231028210326672"
                ></p>
<p>我们跟进去获取到了反序列化器并返回</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231028210635389.png"
                      alt="image-20231028210635389"
                ></p>
<p>这里其实就是获取到了反序列化器</p>
<p>我们这里跟进去看一下</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029143031810.png"
                      alt="image-20231029143031810"
                ></p>
<p>我们这次处理的序列化对象Object是有类型信息的，所以这里会调用<code>_valueDeserializer.deserializeWithType</code>进行处理</p>
<p>跟进到<code>deserializeWithType</code>方法</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029143803433.png"
                      alt="image-20231029143803433"
                ></p>
<p>这里就是jackson用于处理多态对象的地方，<code>typeDeserializer</code>会检查JSON数据中的类型信息，然后选择正确的Java类进行反序列化。这允许在JSON中表示多态数据结构，以便将其准确地还原为Java对象。</p>
<p>我们继续跟进</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029143946516.png"
                      alt="image-20231029143946516"
                ></p>
<p>然后继续调用 _deserialize进行反序列化处理</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144113333.png"
                      alt="image-20231029144113333"
                ></p>
<p>具体的反序列化还是调用这个deserialize方法，然后将反序列化的值返回</p>
<p>继续跟进到这个deserialize方法</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144253448.png"
                      alt="image-20231029144253448"
                ></p>
<p>可以看到又重新跳回了deserialize调用了<code>vanillaDeserialize</code>方法来解析数组内的内容</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144347375.png"
                      alt="image-20231029144347375"
                ></p>
<p>其中调用createUsingDefault()函数的时候会调用到hakcer类的无参构造函数来新建hacker类对象</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144529401.png"
                      alt="image-20231029144529401"
                ></p>
<p>然后再次调用deserializeAndSet()函数获取该属性值并设置到该实例中：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144709046.png"
                      alt="image-20231029144709046"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144725701.png"
                      alt="image-20231029144725701"
                ></p>
<p>然后通过反射获取到hacker类的属性名，然后调用set方法将值设置给hacker对象</p>
<p>因为我在product类里面也写了一个object的set方法</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144904617.png"
                      alt="image-20231029144904617"
                ></p>
<p>所以会在来一次调用这个set方法</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029145008454.png"
                      alt="image-20231029145008454"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029144945486.png"
                      alt="image-20231029144945486"
                ></p>
<p>那么其实上面对于object类型的反序列化首先通过<code>deserializeWithType</code>方法去获取到合适的反序列化器，然后再次调用deserialize方法去进行json对象的反序列化，调用无参构造函数，然然后就是通过反射机制调用该属性的setter方法进行设置。</p>
<p>那么根据上面的分析，我们大概可以总结一下jackson的反序列化过程:先通过无参构造类函数生成目标类的实例，然后根据属性值是否是数组，也就是是否带有类名，如果目标是一个不带有类名的就直接调用deserializeAndSet方法调用set方法将属性值设置，如果是带有类名的，也就是类似于我们上面的数组类型，会先调用deserializeWithType去寻找合适的发序列化器，进行反序列化，然后再构造对象，调用deserializeAndSet方法。</p>
<h1 id="三、jackson反序列化漏洞"><a href="#三、jackson反序列化漏洞" class="headerlink" title="三、jackson反序列化漏洞"></a>三、jackson反序列化漏洞</h1><p>那么根据我们上面的分析，在jackson的反序列化中，若是调用了<code>enableDefaultTyping()</code>函数或使用<code>@JsonTypeInfo</code>注解指定反序列化得到的类的属性为<code>JsonTypeInfo.Id.CLASS</code>或<code>JsonTypeInfo.Id.MINIMAL_CLASS</code>就会调用该属性类的构造函数和set方法。那么现在出现了一个问题，如果我们在构造函数或者set方法中写入一些危险的操作的方法或者函数，那么当反序列化调用构造函数和set方法时就会造成危险利用。这就是我们这次要学习的漏洞jackson反序列化漏洞。</p>
<p>根据上面的分析我们可以得到jackson反序列化的利用前提条件：（满足其一就可）</p>
<ul>
<li><pre><code>调用了ObjectMapper.enableDefaultTyping()函数；
对要进行反序列化的类的属性使用了值为JsonTypeInfo.Id.CLASS或者JsonTypeInfo.Id.MINIMAL_CLASS的@JsonTypeInfo注解
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">分析到这里，我们可以知道这个漏洞的原因就是因为这个jackson在解决多态问题使用的JacksonPolymorphicDeserialization机制存在的问题，导致在反序列化时会调用构造函数和set方法。</span><br><span class="line"></span><br><span class="line">我们这里通过前面的测试代码，在set方法或者构造函数中添加一个弹出计算器的操作来演示这个操作：</span><br><span class="line"></span><br><span class="line">我们这里修改myproductjie这个继承接口的类就行，我在他的一个set方法中添加一个弹出计算器的命令：</span><br><span class="line"></span><br><span class="line">myproductjie类：</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
public class myproductjie implements productjie &#123;
  int price;
  public myproductjie()&#123;
      System.out.println(&quot;这里调用了myproductjie的无参构造方法&quot;);
  &#125;


  @Override
  public void setprice(int price) throws IOException &#123;
      Runtime.getRuntime().exec(&quot;calc&quot;);
      this.price=price;
      System.out.println(&quot;这里是setprice&quot;);

  &#125;

  @Override
  public int getprice() &#123;
      return price;
  &#125;
</code></pre>
</li>
</ul>
<p>}</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">productjie</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>public interface productjie {<br>    public void setprice(int price) throws IOException;<br>    public int getprice();<br>}</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">运行测试：</span><br><span class="line"></span><br><span class="line">![image-20231029173820717](https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029173820717.png)</span><br><span class="line"></span><br><span class="line">可以看到成功弹出了计算器。</span><br><span class="line"></span><br><span class="line">当然我们上面打的是一个非object类的，当我们的目标属性是object类型的，那么我们的攻击面就被扩大了，因为object类型是任意类型的父类，那只需要寻找出在目标服务端环境中存在的且构造函数或setter方法存在漏洞代码的类即可进行攻击利用。</span><br><span class="line"></span><br><span class="line">那我们直接这里修改：</span><br><span class="line"></span><br><span class="line">hacker类：</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>package blog1;</p>
<p>public class hacker {<br>   public String cmd;</p>
<p>   public  hacker(){</p>
<p>   }<br>    public hacker(String cmd){<br>        this.cmd&#x3D;cmd;</p>
<pre><code>&#125;
public void setCmd(String cmd)&#123;
    this.cmd=cmd;
    System.out.println(&quot;122222&quot;);
    try &#123;
        Runtime.getRuntime().exec(this.cmd);
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
    &#125;
&#125;
</code></pre>
<p>}</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">product类：</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>package blog1;</p>
<p>import com.fasterxml.jackson.annotation.JsonTypeInfo;</p>
<p>public class Product {<br>    public int price;<br>    public String name;<br>    @JsonTypeInfo(use &#x3D; JsonTypeInfo.Id.MINIMAL_CLASS)<br>    public Object object;<br>    public Product() {<br>        System.out.println(“Product构造函数”);<br>    }</p>
<pre><code>@Override
public String toString() &#123;
    return String.format(&quot;Prouduct.age=%d, Product.name=%s, %s&quot;, price, name, object == null ? &quot;null&quot; : object);
&#125;
</code></pre>
<p>}</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">测试类：</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>public class test {<br>    public static void main(String[] args) throws IOException {<br>        Product product &#x3D; new Product();<br>        product.price&#x3D;10;<br>        product.name&#x3D;”苹果”;<br>        product.object&#x3D;new hacker(“calc”);<br>        ObjectMapper mapper &#x3D; new ObjectMapper();</p>
<pre><code>    String json = mapper.writeValueAsString(product);
    System.out.println(json);

     Product p2 = mapper.readValue(json, Product.class);
    System.out.println(p2);
&#125;

&#125;
</code></pre>
<pre><code>
运行测试：

![image-20231029183331719](https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20231029183331719.png)

也弹出来计算器。



# 四、总结

上面我们分析和调试了jackson反序列化漏洞产生的原因，也就是因为jackson解决多态问题反序列化的JacksonPolymorphicDeserialization机制存在问题，当调用`enableDefaultTyping()`函数或使用`@JsonTypeInfo`注解指定反序列化得到的类的属性为`JsonTypeInfo.Id.CLASS`或`JsonTypeInfo.Id.MINIMAL_CLASS`就会调用该属性类的构造函数和set方法，导致我们可以反序列化利用。

但是我们上面的测试都是自己写了一个利用类，在真实环境中，是不可能留有一个可以执行命令的后门的，所以我们这里只是简单了一下jackson反序列化的原理和流程。后门我们将分析与其相关的几个cve和利用链。
</code></pre>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> jackson反序列化原理学习</li>
        <li><strong>作者:</strong> GTL-JU</li>
        <li><strong>创建于:</strong> 2023-10-29 18:43:20</li>
        
            <li>
                <strong>更新于:</strong> 2023-10-29 18:44:39
            </li>
        
        <li>
            <strong>链接:</strong> https://gtl-ju.github.io/2023/10/29/jackson反序列化/
        </li>
        <li>
            <strong>版权声明:</strong> 本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> 进行许可。
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/java/">#java</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/10/17/nezuko-1%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">nezuko-1打靶记录</span>
                                    <span class="post-nav-item">下一篇</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">jackson反序列化原理学习</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="nav-text">一、前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%85%B3%E4%BA%8Ejackson"><span class="nav-text">二、关于jackson</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81jackson%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">1、jackson的介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8jackson%E8%BF%9B%E8%A1%8C%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-text">2、使用jackson进行序列化和反序列化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81jackson%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81%E9%97%AE%E9%A2%98"><span class="nav-text">3、jackson中的多态问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81JacksonPolymorphicDeserialization%E6%9C%BA%E5%88%B6%E8%A7%A3%E5%86%B3jackson%E7%9A%84%E5%A4%9A%E6%80%81%E9%97%AE%E9%A2%98"><span class="nav-text">4、JacksonPolymorphicDeserialization机制解决jackson的多态问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DefaultTyping"><span class="nav-text">DefaultTyping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JsonTypeInfo%E6%B3%A8%E8%A7%A3"><span class="nav-text">@JsonTypeInfo注解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%AD%E7%B1%BB%E5%B1%9E%E6%80%A7%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8"><span class="nav-text">5、jackson反序列化中类属性方法的调用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DefaultTyping%E5%9C%BA%E6%99%AF%E4%B8%8B%EF%BC%9A"><span class="nav-text">DefaultTyping场景下：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JsonTypeInfo%E6%B3%A8%E8%A7%A3%E5%9C%BA%E6%99%AF%E4%B8%8B%EF%BC%9A"><span class="nav-text">@JsonTypeInfo注解场景下：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95"><span class="nav-text">动态调试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81jackson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E"><span class="nav-text">三、jackson反序列化漏洞</span></a></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2023</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">GTL-JU</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a> 驱动</span>
                <br>
            <span class="theme-version-container">主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.1.0</a>
        </div>
        
        
        
            <div id="start_div" style="display:none">
                2023/4/8 0:0:0
            </div>
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/navbarShrink.js"></script>

<script src="/js/tools/scrollTopBottom.js"></script>

<script src="/js/tools/lightDarkSwitch.js"></script>



    
<script src="/js/tools/localSearch.js"></script>




    
<script src="/js/tools/codeBlock.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/layouts/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js"></script>







<div class="post-scripts pjax">
    
        
<script src="/js/tools/tocToggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>




</body>
</html>
